<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="iam_Echo">
    
    <title>
        
            RenSystem |
        
        终有沧海替弱水
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"yousite.com","root":"/","language":"en"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.jpg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.jpg","description":"Perseverance can sometimes equal genius in its results"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":false,"preload":false},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.3"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                终有沧海替弱水
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                CATEGORIES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                ABOUT
                            </a>
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">CATEGORIES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">ABOUT</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">RenSystem</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">iam_Echo</span>
                        
                            <span class="author-label">Lv1</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2021-10-27 09:49:02
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3/">开发文档</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Vue-js%E5%85%A8%E5%AE%B6%E6%A1%B6-Vue-element-admin-%E5%BC%80%E5%8F%91-Webpack%E4%BD%BF%E7%94%A8/">Vue.js全家桶 | Vue-element-admin 开发 | Webpack使用</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>16.1k Words</span>
        </span>
    
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="瑞能后台管理系统"><a href="#瑞能后台管理系统" class="headerlink" title="瑞能后台管理系统"></a>瑞能后台管理系统</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>  本项目是一个后台前端的解决方案，其主要是服务于瑞能电气现有的数据库内容，对其进行管理。项目的核心框架是<code>Vue.js</code>（2.6.0），后台数据库是<code>mysql</code>。项目的开发使用了很多<code>webpack</code>的插件以及官方的<code>api</code>，具体见：<a class="link" target="_blank" rel="noopener" href="https://webpack.docschina.org/concepts/">https://webpack.docschina.org/concepts/<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><ul>
<li><p>登录 / 注销</p>
</li>
<li><p>权限验证</p>
</li>
</ul>
<hr>
<p>  多环境发布</p>
<ul>
<li>dev sit stage prod</li>
</ul>
<hr>
<p>  全局功能</p>
<ul>
<li>动态侧边栏（支持多级路由嵌套使用）</li>
<li>动态面包屑导航</li>
<li>快捷导航（标签页）</li>
<li>Screenfull 全屏</li>
<li>自适应收缩侧边栏</li>
</ul>
<hr>
<p>  具体功能</p>
<ul>
<li>用户管理</li>
<li>项目管理</li>
</ul>
<h3 id="系统环境以及项目准备"><a href="#系统环境以及项目准备" class="headerlink" title="系统环境以及项目准备"></a>系统环境以及项目准备</h3><p>​        首先需要在本地安装<code>node.js</code>和<code>vue-cli</code>。本项目技术栈基于，<code>ES5+</code>、<code>vue全家桶</code>、<code>axios</code>以及<code>element UI</code>,所有的数据请求都使用<code>mysql</code>服务器接口来获取。</p>
<h3 id="项目目录结构"><a href="#项目目录结构" class="headerlink" title="项目目录结构"></a>项目目录结构</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">├── build                      <span class="comment"># 构建相关</span></span><br><span class="line">├── plop-templates             <span class="comment"># 基本模板，可以搭配webpack,用来快速构建页面</span></span><br><span class="line">├── public                     <span class="comment"># 静态资源</span></span><br><span class="line">│   └── index.html             <span class="comment"># html模板</span></span><br><span class="line">├── src                        <span class="comment"># 源代码</span></span><br><span class="line">│   ├── api                    <span class="comment"># 所有请求</span></span><br><span class="line">│   ├── assets                 <span class="comment"># 主题 图片 字体等静态资源</span></span><br><span class="line">│   ├── components             <span class="comment"># 全局公用组件</span></span><br><span class="line">│   ├── directive              <span class="comment"># 全局指令 具体见Vue.js官方</span></span><br><span class="line">│   ├── filters                <span class="comment"># 全局 filter</span></span><br><span class="line">│   ├── icons                  <span class="comment"># 项目用到的所有 svg icons</span></span><br><span class="line">│   ├── layout                 <span class="comment"># 全局 layout</span></span><br><span class="line">│   ├── router                 <span class="comment"># 路由</span></span><br><span class="line">│   ├── store                  <span class="comment"># 全局 store管理</span></span><br><span class="line">│   ├── styles                 <span class="comment"># 全局样式</span></span><br><span class="line">│   ├── utils                  <span class="comment"># 全局公用方法</span></span><br><span class="line">│   ├── vendor                 <span class="comment"># 公用vendor</span></span><br><span class="line">│   ├── views                  <span class="comment"># views 所有页面</span></span><br><span class="line">│   ├── App.vue                <span class="comment"># 入口页面</span></span><br><span class="line">│   ├── main.js                <span class="comment"># 入口文件 加载组件 初始化等</span></span><br><span class="line">│   └── permission.js          <span class="comment"># 权限管理</span></span><br><span class="line">├── .env.developemnt           <span class="comment"># 开发环境变量配置</span></span><br><span class="line">├── .env.production            <span class="comment"># 生产环境变量配置</span></span><br><span class="line">├── .env.staging               <span class="comment"># 其余环境变量配置</span></span><br><span class="line">├── .eslintrc.js               <span class="comment"># eslint 配置项</span></span><br><span class="line">├── .eslintignore              <span class="comment"># eslint 语法忽略配置</span></span><br><span class="line">├── .babelrc                   <span class="comment"># babel-loader 配置</span></span><br><span class="line">├── jsconfig.json              <span class="comment"># 根目录和路径的一些配置</span></span><br><span class="line">├── vue.config.js              <span class="comment"># vue-cli 配置</span></span><br><span class="line">├── plopfile.js                <span class="comment"># plop模板 配置</span></span><br><span class="line">├── postcss.config.js          <span class="comment"># postcss 配置</span></span><br><span class="line">└── package.json               <span class="comment"># package.json</span></span><br></pre></td></tr></table></figure>

<h3 id="Vue生态圈"><a href="#Vue生态圈" class="headerlink" title="Vue生态圈"></a>Vue生态圈</h3><pre><code>      1. [Vue Router](https://router.vuejs.org/ ) 是`Vue`官方的路由，它可以快速的构建一个单页面或者多页面的项目
      2. [Vuex](https://vuex.vuejs.org/) 是一个专门为`Vue.js`应用程序开发的状态管理模式。主要是用来解决全局状态和组件之间通信的问题。
      3. Vue loader 是为`Vue`文件定制的一个webpack的loader。它可以在开发的过程中使用热重载来保持状态，为每个组件模拟出scoped CSS等等功能。不过大部分情况下你不需要对它进行配置，因为`Vue-cli`已经处理好了。
      4. Vue CLI 是官方提供的一个`vue`项目脚手架，本项目就是基于它构建完成的。它封装了大量的 `webpack`、`babel `等其它配置，让我们可以轻松地上手写代码，而不用关心配置。
      5. Vetur 是一个`VS Code`的插件，开发Vue这个插件必不可少。
</code></pre>
<h2 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h2><p>​        项目的整体布局包括，导航，侧边栏，面包屑导航以及动态页面标签栏。</p>
<h3 id="layout"><a href="#layout" class="headerlink" title="layout"></a>layout</h3><p>​         layout基本包括了侧边栏，动态面包屑，以及动态标签和中间的<code>AppMain</code>组件，每次路由发生变化后，就是对中间的页面进行替换而其他的组件还是固定不变；当然标签和面包屑是动态的，也会跟着发生命名上的变化，但是位置与样式不发生变化。</p>
<p><img src="/2021/10/27/RenSystem/layout.png" alt="layout"></p>
<p>​        对应的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@/layout</span><br></pre></td></tr></table></figure>

<p>​        <code>@</code>是webpack的<code>alias</code>，在目录的<code>jsconfig.json</code>中有配置，这是webpack的配置文件，主要是配置</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/vue.config.js</span><br><span class="line"> configureWebpack: &#123;</span><br><span class="line">    name: name,</span><br><span class="line">    resolve: &#123;</span><br><span class="line">      alias: &#123;</span><br><span class="line">        <span class="attr">&quot;@&quot;</span>: resolve(<span class="string">&quot;src&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><code>vue.config.js</code>文件配置了<code>webpack</code>和项目构建的一些配置信息。</p>
<hr>
<p>​        项目中大部分页面都会使用到layout，但是也有一小部分页面不会使用layout，例如登录页面，错误页面等等。</p>
<p><img src="/2021/10/27/RenSystem/layout-1.png" alt="layout1"></p>
<p>​        这个例子中也使用了路由嵌套，所以当你改变页面主体时，并不会改变layout中已经配置好的组件，它们不会随着主页面的变化而变化的原因就是如此。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/foo                                  /bar</span><br><span class="line">+------------------+                  +-----------------+</span><br><span class="line">| layout           |                  | layout          |</span><br><span class="line">| +--------------+ |                  | +-------------+ |</span><br><span class="line">| | user.vue     | |  +------------&gt;  | | project.vue | |</span><br><span class="line">| |              | |                  | |             | |</span><br><span class="line">| +--------------+ |                  | +-------------+ |</span><br><span class="line">+------------------+                  +-----------------+</span><br></pre></td></tr></table></figure>

<h3 id="app-main"><a href="#app-main" class="headerlink" title="app-main"></a>app-main</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@/layout/components/AppMain</span><br></pre></td></tr></table></figure>

<p>​        这里在 <code>app-main</code> 外部包了一层 <code>keep-alive</code> 主要是为了缓存 <code>&lt;router-view&gt;</code> 的，配合页面的 <code>tabs-view</code> 标签导航使用。</p>
<p>​        其中<code>transition</code> 定义了页面之间切换动画，可以自定义动画样式。具体<a class="link" target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/guide/transitions.html">文档<i class="fas fa-external-link-alt"></i></a>。默认提供了<code>fade</code>和<code>fade-transform</code>两个转场动画，具体 css 实现见<a class="link" target="_blank" rel="noopener" href="https://github.com/PanJiaChen/vue-element-admin/blob/master/src/styles/transition.scss">transition.scss<i class="fas fa-external-link-alt"></i></a>。如果需要调整可在<a class="link" target="_blank" rel="noopener" href="https://github.com/PanJiaChen/vue-element-admin/blob/master/src/layout/components/AppMain.vue">AppMain.vue<i class="fas fa-external-link-alt"></i></a>中调整<code>transition</code> 的 <code>name</code>。</p>
<h3 id="router-view"><a href="#router-view" class="headerlink" title="router-view"></a>router-view</h3><p>​        这里，由于一个组件可能是一个弹出框，可能你created和edit的组件是同一个，这时候，<code>router-view</code>并不会触发对应组件的<code>mounted</code>和<code>created</code>函数，导致数据无法及时的刷新。</p>
<p>​        官方给的建议是添加一个深度监听<code>watch</code>事件，但是这里使用<code>:key</code>给router-view一个标记符，这样就可以保证每次调用组件，每次进行生命周期的渲染。</p>
<h2 id="路由和侧边栏"><a href="#路由和侧边栏" class="headerlink" title="路由和侧边栏"></a>路由和侧边栏</h2><h3 id="配置项"><a href="#配置项" class="headerlink" title="配置项"></a>配置项</h3><p>首先要知道官方在配置路由时提供了哪些配置项。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当设置 true 的时候该路由不会在侧边栏出现</span></span><br><span class="line"><span class="attr">hidden</span>: <span class="literal">true</span> <span class="comment">// (默认 false)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//当设置 noRedirect 的时候该路由在面包屑导航中不可被点击</span></span><br><span class="line"><span class="attr">redirect</span>: <span class="string">&#x27;noRedirect&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 当你一个路由下面的 children 声明的路由大于1个时，自动会变成嵌套的模式</span></span><br><span class="line"><span class="comment">// 只有一个时，会将那个子路由当做根路由显示在侧边栏</span></span><br><span class="line"><span class="comment">// 若你想不管路由下面的 children 声明的个数都显示你的根路由</span></span><br><span class="line"><span class="comment">// 你可以设置 alwaysShow: true，这样它就会忽略之前定义的规则，一直显示根路由</span></span><br><span class="line"><span class="attr">alwaysShow</span>: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设定路由的名字，一定要填写不然使用&lt;keep-alive&gt;时会出现各种问题</span></span><br><span class="line"><span class="attr">name</span>: <span class="string">&#x27;router-name&#x27;</span> </span><br><span class="line"><span class="comment">// 这里的属性大多数都会在路由守卫时用到，看个人喜好</span></span><br><span class="line"><span class="attr">meta</span>: &#123;</span><br><span class="line">  <span class="attr">roles</span>: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;editor&#x27;</span>] <span class="comment">// 设置该路由进入的权限，支持多个权限叠加</span></span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;title&#x27;</span> <span class="comment">// 设置该路由在侧边栏和面包屑中展示的名字</span></span><br><span class="line">  <span class="attr">icon</span>: <span class="string">&#x27;svg-name&#x27;</span> <span class="comment">// 设置该路由的图标</span></span><br><span class="line">  <span class="attr">noCache</span>: <span class="literal">true</span> <span class="comment">// 如果设置为true，则不会被 &lt;keep-alive&gt; 缓存(默认 false)</span></span><br><span class="line">  <span class="attr">breadcrumb</span>: <span class="literal">false</span> <span class="comment">//  如果设置为false，则不会在breadcrumb面包屑中显示(默认 true)</span></span><br><span class="line">  <span class="attr">affix</span>: <span class="literal">true</span> <span class="comment">// 如果设置为true，它则会固定在tags-view中(默认 false)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 当路由设置了该属性，则会高亮相对应的侧边栏。</span></span><br><span class="line">  <span class="attr">activeMenu</span>: <span class="string">&#x27;/article/list&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>​        这里的路由分为两种：<code>constantRoutes</code> 和 <code>asyncRoutes</code>。</p>
<p>​        <strong>constantRoutes</strong>：代表那些不需要动态判断路由权限的路由，如登录页面，错误页面。</p>
<p>​        <strong>asyncRoutes</strong>:代表那些需要动态判断路由权限并通过addRoutes动态添加的页面。</p>
<p><img src="/2021/10/27/RenSystem/Router.png" alt="Router"></p>
<p>​        这里所有的路由都使用了<code>路由懒加载</code>，具体文档还是要看官方。这里简单的介绍一下，就是利用了箭头函数以及<code>webpack</code>的<code>import</code>导入机制：所有的路由都是通过组件的方式引入的，但是我们的页面如果有五个十个组件是可以手动引入并且进行配置的，但是如果组件页面很多，如果分别手动引入并且进行配置，不仅费时费力，而且会导致项目运行缓慢，所以这里路由的组件，全部使用懒加载的方式，当路由确定跳转使用时，再将组件引入并展示出来。</p>
<h3 id="侧边栏"><a href="#侧边栏" class="headerlink" title="侧边栏"></a>侧边栏</h3><p>​        本项目的侧边栏主要是利用<code>element UI</code>的<code>el-menu</code>开发的</p>
<p>​        前面也介绍了，侧边栏是通过读取路由并结合权限判断而动态生成的，而且还需要支持路由无限嵌套，所以这里还使用到了递归组件。具体内容看代码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@/layout/components/Sidebar</span><br></pre></td></tr></table></figure>

<p>​        <strong>这里需要注意一下</strong>，一般侧边栏有两种形式即：<code>submenu</code> 和 直接 <code>el-menu-item</code>。 一个是嵌套子菜单，另一个则是直接一个链接。</p>
<p><img src="/2021/10/27/RenSystem/Siderbar.png" alt="Siderbar"></p>
<p>​        <strong>前面也介绍过</strong>，如果不想要直接显示根路径，可以将路由配置文件中的，alwaysshow设置为true。</p>
<h3 id="多级目录（嵌套路由）"><a href="#多级目录（嵌套路由）" class="headerlink" title="多级目录（嵌套路由）"></a>多级目录（嵌套路由）</h3><p>​        如果路由不止于二级路由，那么就会发生嵌套路由的情况，有三级路由的情况下，<strong>不要忘记还要手动在二级目录的根文件下添加一个</strong><code>router-view</code></p>
<p>原则上，有多少级路由就嵌套多少个<code>router-view</code>。二级路由本身在appMain中已经有了，所以三级路由加一个，四级路由需要加两个，以此类推。</p>
<p><code>路由和侧边栏就介绍这么多，至于面包屑导航，以及头像工具栏，代码较为简单，看组件即可</code></p>
<h2 id="权限验证"><a href="#权限验证" class="headerlink" title="权限验证"></a>权限验证</h2><h3 id="基础-1"><a href="#基础-1" class="headerlink" title="基础"></a>基础</h3><p>​        本项目权限实现的方式是：获取当前用户的权限去对比路由表，生成当前用户具有的权限可访问的路由表，通过<code>router.addRoutes</code>动态挂载到Router上。</p>
<p>​        但是，由于我们的项目本身是服务于内网的，所以我在逻辑判断的的过程中，只设置了admin一个角色，也就是需要后台将逻辑变成只允许admin用户登录，当登陆之后，我会设置登录的<code>role</code>是<code>[admin]</code>这样，就可以看到所有的路由，那么权限就是最高，所有的动态路由也就都可以被挂载显示出来，这样我们就可以通过手动修改源码中的<code>hidden：true</code>来隐藏一些不会使用到的路由。</p>
<p><code>ps: 这里我本人觉得，项目服务于内网，服务于公司内部人员，并不存在角色权限管理的问题，并且路由项目也不是很多，所以做一个动态的角色管理和动态侧边栏确实存在 有劲没处使的情况，反而会增加项目运行的负担</code></p>
<h3 id="逻辑修改"><a href="#逻辑修改" class="headerlink" title="逻辑修改"></a>逻辑修改</h3><p>​        这里需要修改逻辑的话，就要用到<code>@/permission.js</code>,这里需要仔细的介绍一下这个项目的判断逻辑。</p>
<p>​        首先，我们需要先看<code>@/views/login/index.vue</code>来查看登录的源码，会发现其中登录函数是调用了Vuex中的登录方法的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">handleLogin</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="built_in">this</span>.$refs.loginForm.validate(<span class="function"><span class="params">valid</span> =&gt;</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">         <span class="built_in">this</span>.loading = <span class="literal">true</span>;</span><br><span class="line">         <span class="comment">// $store中的方法是action</span></span><br><span class="line">         <span class="comment">// dispatch是调用user.js中的action方法中的login,并且传参</span></span><br><span class="line">         <span class="built_in">this</span>.$store</span><br><span class="line">           .dispatch(<span class="string">&quot;user/login&quot;</span>, <span class="built_in">this</span>.loginForm)</span><br><span class="line">           .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">             <span class="built_in">this</span>.$router.push(&#123;</span><br><span class="line">               <span class="attr">path</span>: <span class="string">&quot;/&quot;</span></span><br><span class="line">             &#125;);</span><br><span class="line">             <span class="built_in">this</span>.loading = <span class="literal">false</span>;</span><br><span class="line">           &#125;)</span><br><span class="line">           .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">             <span class="built_in">console</span>.log(error);</span><br><span class="line">             <span class="built_in">this</span>.loading = <span class="literal">false</span>;</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="built_in">console</span>.log(<span class="string">&quot;error submit!!&quot;</span>);</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;);</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>​        然后，我们需要找到<code>@/store/modules/user/login</code>方法，至于store的工作方法，以及本项目Vuex的一些构造和知识点，后面在Vuex中我们进行介绍。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; login &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/user&quot;</span>;</span><br><span class="line"><span class="comment">// 引用鉴权方法 获取token ，设置token 和 移除token的三个方法</span></span><br><span class="line"><span class="keyword">import</span> &#123; getToken,setToken,removeToken,getTokens,removeTokens&#125; <span class="keyword">from</span> <span class="string">&quot;@/utils/auth&quot;</span>;</span><br><span class="line"><span class="comment">// 这里是路由方法</span></span><br><span class="line"><span class="keyword">import</span> router, &#123; resetRouter &#125; <span class="keyword">from</span> <span class="string">&quot;@/router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Cookies <span class="keyword">from</span> <span class="string">&quot;js-cookie&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里是状态设置 state的初始化  可以理解为实例</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">token</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (getToken()) &#123;</span><br><span class="line">      <span class="keyword">return</span> getToken();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> getTokens();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="comment">// 当我们想要动态绑定img的src的时候，Vue数据绑图片的相对路径或者绝对路径的时候，必须要require</span></span><br><span class="line">  <span class="attr">avatar</span>: <span class="built_in">require</span>(<span class="string">&quot;../../assets/image/header.jpeg&quot;</span>),</span><br><span class="line">  <span class="attr">introduction</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">roles</span>: []</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里是 mutation  可以理解为实例对应的方法</span></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="attr">SET_TOKEN</span>: <span class="function">(<span class="params">state, token</span>) =&gt;</span> &#123;</span><br><span class="line">    state.token = token;</span><br><span class="line">    sessionStorage.setItem(<span class="string">&quot;token&quot;</span>, token);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">SET_INTRODUCTION</span>: <span class="function">(<span class="params">state, introduction</span>) =&gt;</span> &#123;</span><br><span class="line">    state.introduction = introduction;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">SET_NAME</span>: <span class="function">(<span class="params">state, name</span>) =&gt;</span> &#123;</span><br><span class="line">    state.name = name;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">SET_AVATAR</span>: <span class="function">(<span class="params">state, avatar</span>) =&gt;</span> &#123;</span><br><span class="line">    state.avatar = avatar;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">SET_ROLES</span>: <span class="function">(<span class="params">state, roles</span>) =&gt;</span> &#123;</span><br><span class="line">    state.roles = roles;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">// user login</span></span><br><span class="line">  <span class="comment">// 这里的commit是简略写法，就是为了省去context这个直接进行commit调用</span></span><br><span class="line">  <span class="comment">// 第一个login是vueX中定义的方法，第二个login是api中定义的方法</span></span><br><span class="line">  <span class="function"><span class="title">login</span>(<span class="params">&#123; commit &#125;, userInfo</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; username, password &#125; = userInfo;</span><br><span class="line">    <span class="comment">//  将用户名和密码存到本地缓存中</span></span><br><span class="line">    <span class="built_in">window</span>.localStorage.setItem(<span class="string">&quot;userInfo&quot;</span>, <span class="built_in">JSON</span>.stringify(userInfo));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      login(&#123; <span class="attr">username</span>: username.trim(), <span class="attr">password</span>: password &#125;)</span><br><span class="line">        .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">//   这里一定是要有token的 如果不设置token 是会报错的 无法登录成功的</span></span><br><span class="line">          <span class="keyword">let</span> token = response.data.Authorization;</span><br><span class="line">          commit(<span class="string">&quot;SET_TOKEN&quot;</span>, token); </span><br><span class="line">          setToken(token); </span><br><span class="line">          resolve();</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">          reject(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get user info</span></span><br><span class="line">  <span class="function"><span class="title">getInfo</span>(<span class="params">&#123; commit, state &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//   这里直接获取本地的存储登录信息</span></span><br><span class="line">      <span class="comment">//   这个方法会在路由守卫页面被调用</span></span><br><span class="line">      <span class="keyword">var</span> data = <span class="built_in">JSON</span>.parse(<span class="built_in">window</span>.localStorage.getItem(<span class="string">&quot;userInfo&quot;</span>));</span><br><span class="line">      <span class="keyword">if</span> (!data) &#123;</span><br><span class="line">        reject(<span class="string">&quot;登陆失败，重新登陆&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      commit(<span class="string">&quot;SET_ROLES&quot;</span>, [<span class="string">&quot;admin&quot;</span>]);</span><br><span class="line"></span><br><span class="line">      resolve(data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// user logout 没有接口就先只清除token</span></span><br><span class="line">  <span class="function"><span class="title">logout</span>(<span class="params">&#123; commit, state, dispatch &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">     </span><br><span class="line">      commit(<span class="string">&quot;SET_TOKEN&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">      commit(<span class="string">&quot;SET_ROLES&quot;</span>, []);</span><br><span class="line">      removeToken();</span><br><span class="line">      removeTokens();</span><br><span class="line">      resetRouter();</span><br><span class="line">      dispatch(<span class="string">&quot;tagsView/delAllViews&quot;</span>, <span class="literal">null</span>, &#123; <span class="attr">root</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line">      resolve();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  actions</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​        如上图源码，其中很多注释，我给删除了，具体的可以到源码里面去找，看详细的代码解释。这里，具体的意思就是：<br>​        点击登录调用<code>action</code>中的login方法，然后先将用户名和密码存入本地，这里主要是因为没有获取用户信息的接口，所以为了<code>genInfo</code>方法可以有一个判断依据，所以加了这么一行代码。<br>​        当用户接口成功返回信息之后，设置token，并且调用<code>@/until/auth.js</code>中的鉴权方法，将<code>Token</code>存入<code>Cookie</code>中，后面使用。其他的方法，后面会介绍到。<br>​        接下来就需要看这个鉴权的方法，就是比较简单的几个函数，通过Cookie来进行Token的设置和清除。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Cookies <span class="keyword">from</span> <span class="string">&quot;js-cookie&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TokenKey = <span class="string">&quot;Admin-Token&quot;</span>; <span class="comment">//直接登录管理系统</span></span><br><span class="line"><span class="keyword">const</span> TokenKeys = <span class="string">&quot;Token&quot;</span>; <span class="comment">//通过集控页面跳转而拿到的Token</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取Token的方法</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getToken</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Cookies.get(TokenKey);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 获取Token的方法</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getTokens</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Cookies.get(TokenKeys);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setToken</span>(<span class="params">token</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Cookies.set(TokenKey, token, &#123; <span class="attr">expires</span>: <span class="number">1</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除Token的方法</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">removeTokens</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Cookies.remove(TokenKeys);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">removeToken</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> Cookies.remove(TokenKey);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​        这里设置和清除token都写了两个方法，是因为<code>token</code>的<code>key</code>不同，需要兼容本身项目直接登录和从另一个项目跳转过来的问题，按照李琪的设计逻辑，本项目本身就不需要<code>login</code>页面，登录的方式就是从<code>集控</code>项目跳转过来即可，所以，只需要判断是否存在Token就够了，如果有Token就按照Token进行分配路由然后进入页面，具体的权限判断见下图：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;./router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;./store&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Message &#125; <span class="keyword">from</span> <span class="string">&quot;element-ui&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> NProgress <span class="keyword">from</span> <span class="string">&quot;nprogress&quot;</span>; <span class="comment">// 一个进度条的插件</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;nprogress/nprogress.css&quot;</span>; <span class="comment">// 进度条对应的css文件</span></span><br><span class="line"><span class="keyword">import</span> &#123; getToken, getTokens &#125; <span class="keyword">from</span> <span class="string">&quot;@/utils/auth&quot;</span>; <span class="comment">// 这是一个鉴权的方法，getToken是其中一个获取token的方法</span></span><br><span class="line"><span class="keyword">import</span> getPageTitle <span class="keyword">from</span> <span class="string">&quot;@/utils/get-page-title&quot;</span>; <span class="comment">//这是一个获取页面标题的方法</span></span><br><span class="line"></span><br><span class="line">NProgress.configure(&#123; <span class="attr">showSpinner</span>: <span class="literal">false</span> &#125;); </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> whiteList = [<span class="string">&quot;/login&quot;</span>, <span class="string">&quot;/auth-redirect&quot;</span>]; <span class="comment">//白名单 可以直接进入</span></span><br><span class="line"></span><br><span class="line">router.beforeEach(<span class="keyword">async</span> (to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">  <span class="comment">// * 开启进度条</span></span><br><span class="line">  NProgress.start();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// * 设置页面的标题</span></span><br><span class="line">  <span class="built_in">document</span>.title = getPageTitle(to.meta.title);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ! 确定用户是否已登录 两次鉴权 确保两种方式登录都是可以的</span></span><br><span class="line">  <span class="keyword">const</span> hasToken = getToken();</span><br><span class="line">  <span class="keyword">const</span> hadToken = getTokens();</span><br><span class="line">  <span class="comment">// !如果是从上一个项目跳转过来的 就会有Token 然后就会自动进入首页</span></span><br><span class="line">  <span class="keyword">if</span> (hasToken || hadToken) &#123;</span><br><span class="line">    <span class="keyword">if</span> (to.path === <span class="string">&quot;/login&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// * 如果已登录，请重定向到主页</span></span><br><span class="line">      next(&#123; <span class="attr">path</span>: <span class="string">&quot;/&quot;</span> &#125;);</span><br><span class="line">      NProgress.done(); <span class="comment">// ? 浏览器顶部的进度条 这里如果是去login页面就要结束这个方法</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//  * 确定用户是否已通过getInfo获得其权限角色</span></span><br><span class="line">      <span class="keyword">const</span> hasRoles = store.getters.roles &amp;&amp; store.getters.roles.length &gt; <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> (hasRoles) &#123;</span><br><span class="line">        next();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;尝试获取roles&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">//   ! 调用这个异步方法 来使得commit执行 给role赋值</span></span><br><span class="line">          <span class="keyword">await</span> store.dispatch(<span class="string">&quot;user/getInfo&quot;</span>);</span><br><span class="line">          <span class="comment">//   ! 用这个方法来获取roles的值 直接action异步方法 无法直接获取到roles</span></span><br><span class="line">          <span class="comment">//   * 这个属于利用异步方法的执行线程 来获取roles</span></span><br><span class="line">          <span class="keyword">var</span> roles = store.getters.roles;</span><br><span class="line"></span><br><span class="line">          <span class="comment">//  按照权限生成路由列表</span></span><br><span class="line">          <span class="keyword">const</span> accessRoutes = <span class="keyword">await</span> store.dispatch(</span><br><span class="line">            <span class="string">&quot;permission/generateRoutes&quot;</span>,</span><br><span class="line">            roles</span><br><span class="line">          );</span><br><span class="line">          <span class="comment">//   将路由addRoutes添加进去</span></span><br><span class="line">          <span class="comment">//  ! 使用next(&#123; ...to, replace: true &#125;)来确保addRoutes()时动态添加的路由已经被完全加载上去。</span></span><br><span class="line">          <span class="comment">//   replace：true，告诉vue不可以通过后退按钮让路由退回</span></span><br><span class="line">          router.addRoutes(accessRoutes);</span><br><span class="line">          <span class="comment">//    next()不可以包含参数，一旦包含参数的next()不是放行 而是中断这次路由守卫的判断 再次进入</span></span><br><span class="line">          <span class="comment">//    这里是在执行新的路由 不是直接跳转到新的路由</span></span><br><span class="line">          <span class="comment">//    所以这里会再次进行前面的判断</span></span><br><span class="line">          <span class="comment">//    这次roles为true了 就直接放行 而放行的方法就是next()</span></span><br><span class="line">          next(&#123; ...to, <span class="attr">replace</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">          <span class="comment">// remove token and go to login page to re-login</span></span><br><span class="line">          <span class="keyword">await</span> store.dispatch(<span class="string">&quot;user/resetToken&quot;</span>);</span><br><span class="line">          Message.error(error || <span class="string">&quot;Has Error&quot;</span>);</span><br><span class="line">          next(<span class="string">`/login?redirect=<span class="subst">$&#123;to.path&#125;</span>`</span>);</span><br><span class="line">          NProgress.done();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">/* has no token*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (whiteList.indexOf(to.path) !== -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// in the free login whitelist, go directly</span></span><br><span class="line">      next();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// other pages that do not have permission to access are redirected to the login page.</span></span><br><span class="line">      next(<span class="string">`/login?redirect=<span class="subst">$&#123;to.path&#125;</span>`</span>);</span><br><span class="line">      NProgress.done();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.afterEach(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// finish progress bar</span></span><br><span class="line">  NProgress.done();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​        基于，上面的注释，做一个大概的逻辑概述：首先通过鉴权方法判断是否存在Token，存在的情况下，就判断<code>to</code>的路径。<br>​        如果是去登录页面，那么就跳转到登录，登陆之后就进入<code>path:/</code>，也就是首页，这里这个路径是在<code>router/index.js</code>中设置过，会重定向到<code>数据看板</code>界面。<br>​        如果不是去登录页面，那么就需要判断角色来进行生成路由，后在<code>try...catch...</code>中调用getInfo方法，这里需要异步调用，如果不写<code>await</code>，就会直接变成返回一个<code>promise</code>，反而导致方法并没有执行，具体方法见前面的介绍，因为<code>getInfo</code>是返回的是一个<code>promise</code>所以可以使用await方法，等待这个方法执行完毕，<code>role</code>也被赋值为<code>[&#39;admin&#39;]</code>,这时调用<code>store.getters</code>方法获取当前的角色,再按照权限生成路由列表，后通过<code>addRoutes</code>挂载固定路由和动态路由，这时就成功进入了页面。<br>​        具体函数细节的地方，都写到源码的注释里面了，例如：<code>next()</code>的正确用法，以及逻辑理解和可能会遇到的问题。</p>
<h2 id="快捷导航（标签栏导航）"><a href="#快捷导航（标签栏导航）" class="headerlink" title="快捷导航（标签栏导航）"></a>快捷导航（标签栏导航）</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">运用 keep-alive 和 router-view 的结合。</span><br><span class="line"></span><br><span class="line">代码: @/layout/components/AppMain.vue</span><br></pre></td></tr></table></figure>

<h3 id="visitedViews-amp-amp-cachedViews"><a href="#visitedViews-amp-amp-cachedViews" class="headerlink" title="visitedViews &amp;&amp; cachedViews"></a>visitedViews &amp;&amp; cachedViews</h3><p>目前tag-view中存在两个数组。</p>
<ul>
<li>visitedViews : 用户访问过的页面  就是标签栏导航显示的一个个 tag 数组集合</li>
<li>cachedViews：实际keep-alive的路由。可以在配置路由时通过meta.noCache来设置是否需要缓存这个路由，默认情况下都是缓存的，特殊情况请设置为true，如果没有这个属性，就需要自己在配置中添加属性。</li>
</ul>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>​        由于目前<code>keep-alive</code>和<code>router-view</code>是强耦合的，而且查看文档和源码不难发现<code>keep-alive</code>的<code>include</code>默认是优先匹配name的，所以编写路由<code>router</code>和路由对应的<code>view component</code>的时候，一定要确保两者的name是一样的，就是<code>router</code>中<code>name</code>取什么名字，就要保证组件也写一样的名字。**(切记 name 命名时候尽量保证唯一性 切记不要和某些组件的命名重复了，不然会递归引用最后内存溢出等问题)**</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user-table.vue</span></span><br><span class="line"><span class="attr">name</span>: <span class="string">&quot;user-table&quot;</span>,</span><br><span class="line">    </span><br><span class="line"><span class="comment">// router/index.js</span></span><br><span class="line">&#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&quot;user-table&quot;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;@/views/table/user-table&quot;</span>),</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;user-table&quot;</span>,</span><br><span class="line">      <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&quot;用户列表&quot;</span> &#125;</span><br><span class="line"> &#125;,    </span><br></pre></td></tr></table></figure>

<h3 id="代码和组件的移除"><a href="#代码和组件的移除" class="headerlink" title="代码和组件的移除"></a>代码和组件的移除</h3><p>​        其实，使用<code>keep-alive</code>需要对它本身的源码有很深入的了解，标签导航栏，就是利用它实现的，但是，还是不太成熟，如果递归的项目较多，是不建议使用的。组件源码是Vue-element-admin提供的。<strong>（这边官方给的建议是项目如果用不到这个功能，就尽量移除这个功能，防止出现不必要的错误）</strong></p>
<h2 id="与服务端交互"><a href="#与服务端交互" class="headerlink" title="与服务端交互"></a>与服务端交互</h2><h3 id="前端请求流程"><a href="#前端请求流程" class="headerlink" title="前端请求流程"></a>前端请求流程</h3><p>在本项目中，一个完整的前端UI请求流程是这样的：</p>
<ol>
<li>UI 组件交互操作；</li>
<li>调用统一管理的 api service 请求函数；</li>
<li>使用封装的 request.js 发送请求；</li>
<li>获取服务端返回；</li>
<li>更新 data；</li>
</ol>
<p>​       由此可知，我们的所有请求处理都放在<code>@/api</code>文件夹中，并且一般情况下是按照model纬度进行拆分文件。<strong>（就是Vue和webpack的模块思想）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">api/</span><br><span class="line">  login.js</span><br><span class="line">  article.js</span><br><span class="line">  remoteSearch.js</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<h3 id="request-js"><a href="#request-js" class="headerlink" title="request.js"></a>request.js</h3><p>​        其中，<code>@/utils/request.js</code> 是基于 <a class="link" target="_blank" rel="noopener" href="https://github.com/axios/axios">axios<i class="fas fa-external-link-alt"></i></a> 的封装，便于统一处理 POST，GET 等请求参数，请求头，以及错误提示信息等。 它封装了全局 <code>request拦截器</code>、<code>response拦截器</code>、<code>统一的错误处理</code>、<code>统一做了超时处理</code>、<code>baseURL设置等</code>。如下代码块：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; MessageBox, Message &#125; <span class="keyword">from</span> <span class="string">&quot;element-ui&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;@/store&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getToken, getTokens &#125; <span class="keyword">from</span> <span class="string">&quot;@/utils/auth&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个axios 实例</span></span><br><span class="line"><span class="keyword">const</span> service = axios.create(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: process.env.VUE_APP_BASE_API, <span class="comment">// url = base url + request url</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span> </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// request拦截器</span></span><br><span class="line"><span class="comment">// 发送请求需要带上token，这里是获取token并配置到请求头中，api才可以返回数据</span></span><br><span class="line">service.interceptors.request.use(</span><br><span class="line">  <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">if</span> (store.getters.token) &#123;</span><br><span class="line">      <span class="keyword">if</span> (getToken()) &#123;</span><br><span class="line">       config.headers[<span class="string">&quot;Authorization&quot;</span>] = getToken();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        config.headers[<span class="string">&quot;Authorization&quot;</span>] = getTokens();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error); <span class="comment">// for debug</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// response拦截器</span></span><br><span class="line"><span class="comment">// 这里我只写了如果返回的状态不是1，就是登陆失败了。这个状态码只是用来处理登录请求的</span></span><br><span class="line"><span class="comment">// 当然，项目如果返回的是 401，402,404，甚至500都是后台设置好的</span></span><br><span class="line"><span class="comment">// 可以依据后台接口返回的数据而定</span></span><br><span class="line">service.interceptors.response.use(</span><br><span class="line">  <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = response.data;</span><br><span class="line">    <span class="keyword">if</span> (res.code !== <span class="number">1</span>) &#123;</span><br><span class="line">      Message(&#123;</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;Error&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">        <span class="attr">duration</span>: <span class="number">5</span> * <span class="number">1000</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;err&quot;</span> + error); <span class="comment">// for debug</span></span><br><span class="line">    Message(&#123;</span><br><span class="line">      <span class="attr">message</span>: response.data,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">5</span> * <span class="number">1000</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​        上面的代码就是一个封装好的非常成熟的<code>axios</code>插件，其中包含了各种拦截器，对请求进行拦截并加上<code>Token</code>，以及对接口返回的拦截，对状态码的判断等等。根据项目接口的实际情况进行灵活的改变，可以大大地提高项目调试的效率。</p>
<h3 id="api实例"><a href="#api实例" class="headerlink" title="api实例"></a>api实例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">@/api/user.js</span><br><span class="line"></span><br><span class="line"><span class="comment">//请求用户列表</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchList</span>(<span class="params">query</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/api/user/selectPage&quot;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: query</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// views/table/user-table.vue</span></span><br><span class="line"><span class="keyword">import</span> &#123; fetchList &#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/article&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="attr">list</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">listLoading</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="function"><span class="title">fetchData</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.listLoading = <span class="literal">true</span></span><br><span class="line">      fetchList().then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.list = response.data</span><br><span class="line">        <span class="built_in">this</span>.listLoading = <span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="设置多个baseURL"><a href="#设置多个baseURL" class="headerlink" title="设置多个baseURL"></a>设置多个baseURL</h3><p>我们可以通过环境变量来设置多个baseURL，从而请求不同的api地址</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .env.development</span></span><br><span class="line"><span class="attr">VUE_APP_BASE_API</span> = <span class="string">&#x27;/dev-api&#x27;</span>    <span class="comment">#注入本地 api 开发服务器1的根路径</span></span><br><span class="line"><span class="attr">VUE_APP_BASE_API2</span> = <span class="string">&#x27;/dev-api2&#x27;</span>  <span class="comment">#注入本地 api2 开发服务器2的根路径</span></span><br></pre></td></tr></table></figure>

<p>之后根据环境变量创建<code>axios</code>实例，让它具有不同的<code>baseURL</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create an axios instance</span></span><br><span class="line"><span class="keyword">const</span> service = axios.create(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: process.env.BASE_API, <span class="comment">// api 的 base_url</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span> </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> service2 = axios.create(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: process.env.BASE_API2, <span class="comment">// api2 的 base_url</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>​        这时，需要用哪个服务器就用哪个service，具体的方法在前面的示例中已经介绍过了。就只需要进行实例的替换即可。<br>​        如果，觉得麻烦，也可以直接在api接口中，多传一个参数叫<code>baseURL</code>,这样会直接覆盖，本身写在<code>request</code>中的<code>baseURL</code>。</p>
<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><p>​        在这里稍微解释一下环境变量，由于项目是用<code>vue-cli</code>构建的，所以所有的环境变量配置都是基于<code>vue-cli</code>来实现和控制的。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.env                <span class="comment"># 在所有的环境中被载入</span></span><br><span class="line">.env.<span class="section">[mode]</span>         <span class="comment"># 只在指定的模式中被载入</span></span><br><span class="line"><span class="comment">#这里最开始的项目目录结构介绍呼应，这就是为什么要那样命名的原因。</span></span><br></pre></td></tr></table></figure>

<p>​        注意：环境变量必须必须以<code>VUE_APP_</code>为开头。如:<code>VUE_APP_API</code>、<code>VUE_APP_TITLE</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(process.env.VUE_APP_xxxx)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>NODE_ENV</code> - 会是 “development”、”production” 或 “test” 中的一个。具体的值取决于应用运行的模式</li>
<li><code>BASE_URL</code> - 会和 <code>vue.config.js</code> 中的 <code>publicPath</code> 选项相符，即你的应用会部署到的基础路径</li>
</ul>
<h4 id="构建相关"><a href="#构建相关" class="headerlink" title="构建相关"></a>构建相关</h4><p>​        除了一些写在<code>.env</code>的环境变量之外，还有一些构建和部署相关的变量都是需要在<code>vue.config.js</code>中配置的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/vue.config.js</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// 项目部署到的基础路径，这里不设置&quot;./&quot;打包之后会是空白</span></span><br><span class="line">  <span class="attr">publicPath</span>: process.env.NODE_ENV === <span class="string">&quot;production&quot;</span> ? <span class="string">&quot;./&quot;</span> : <span class="string">&quot;/&quot;</span>,</span><br><span class="line">  <span class="comment">// 打包构建输出的路径 是根目录的dist文件夹</span></span><br><span class="line">  <span class="attr">outputDir</span>: <span class="string">&quot;dist&quot;</span>,</span><br><span class="line">  <span class="comment">// 这里指的是 静态文件的文件夹</span></span><br><span class="line">  <span class="attr">assetsDir</span>: <span class="string">&quot;static&quot;</span>,</span><br><span class="line">  <span class="comment">//   lintOnSave: process.env.NODE_ENV === &quot;development&quot;,</span></span><br><span class="line">  <span class="comment">// productionSourceMap: false,</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="comment">// 设置端口</span></span><br><span class="line">    <span class="attr">port</span>: port,</span><br><span class="line">    <span class="comment">// 配置自动启动浏览器</span></span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 配置多个代理</span></span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="comment">// 这里正常前面是要改名字 将域名或者服务器 地址改成短的 比如api一类</span></span><br><span class="line">      [process.env.VUE_APP_BASE_API]: &#123;</span><br><span class="line">        <span class="attr">target</span>: process.env.VUE_APP_BASE_API, <span class="comment">// 要访问的域名接口</span></span><br><span class="line">        <span class="comment">// 开启代理：在本地会创建一个虚拟服务端，然后发送请求的数据，并同时接收请求的数据，这样服务端和服务端进行数据的交互就不会有跨域问题</span></span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// * 用这个地址，来代替 taget里面的地址，</span></span><br><span class="line">        <span class="comment">// ! 比如我要调用&#x27;http://10.0.4.42:7888/user&#x27;，直接写&#x27;[]/user/add&#x27;即可</span></span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">          [<span class="string">&quot;^&quot;</span> + process.env.VUE_APP_BASE_API]: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">//   before: require(&#x27;./mock/mock-server.js&#x27;)   不使用mock服务器</span></span><br><span class="line">  &#125;, </span><br></pre></td></tr></table></figure>

<p>其他配置文件的意义:<code>jsconfig.json</code>文件指定根文件和<a class="link" target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://github.com/Microsoft/TypeScript/wiki/JavaScript-Language-Service-in-Visual-Studio">JavaScript语言服务<i class="fas fa-external-link-alt"></i></a>提供的功能选项。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;baseUrl&quot;</span>: <span class="string">&quot;./&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;paths&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;@/*&quot;</span>: [<span class="string">&quot;src/*&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;exclude&quot;</span>: [<span class="string">&quot;node_modules&quot;</span>, <span class="string">&quot;dist&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Visual Studio Code的JavaScript支持可以在两种不同的模式下运行：</p>
<ul>
<li><strong>文件范围 - 没有jsconfig.json</strong>：在此模式下，在Visual Studio Code中打开的JavaScript文件被视为独立单元。 只要文件a.js没有显式引用文件b.ts（使用///引用指令或<strong>CommonJS</strong>模块），两个文件之间就没有共同的项目上下文。</li>
<li><strong>显式项目 - 使用jsconfig.json</strong>：<code>JavaScript</code>项目是通过<code>jsconfig.json</code>文件定义的。 目录中存在此类文件表示该目录是JavaScript项目的根目录。 文件本身可以选择列出属于项目的文件，要从项目中排除的文件，以及编译器选项（见下文）。</li>
</ul>
<p><strong>文件位置</strong>：项目的根目录下</p>
<p><strong>excluede</strong>：</p>
<p>​        exclude属性（<a class="link" target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://www.cnblogs.com/xdlysk/p/5183604.html">glob模式<i class="fas fa-external-link-alt"></i></a>）告诉语言服务哪些文件是什么文件，而不是源代码的一部分。 </p>
<p><strong>jsconfig的属性</strong>：</p>
<table>
<thead>
<tr>
<th align="center">选项</th>
<th align="center">描述</th>
<th align="center">类型</th>
<th align="center">默认</th>
</tr>
</thead>
<tbody><tr>
<td align="center">noLib</td>
<td align="center">不包含默认库文件</td>
<td align="center">string</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">target</td>
<td align="center">指定要使用的默认库（ES6..）</td>
<td align="center">string</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">baseUrl</td>
<td align="center">用于解析非相对模块名称的基目录。</td>
<td align="center">string</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">paths</td>
<td align="center">指定相对于baseUrl选项计算的路径映射。</td>
<td align="center">object</td>
<td align="center">见demo</td>
</tr>
</tbody></table>
<p><strong>使用webpack别名(与alias类似)</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;baseUrl&quot;</span>: <span class="string">&quot;.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;paths&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;ClientApp/*&quot;</span>: [<span class="string">&quot;src/*&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//项目中 </span></span><br><span class="line"><span class="keyword">import</span> Something <span class="keyword">from</span> <span class="string">&#x27;ClientApp/foo&#x27;</span></span><br><span class="line"><span class="comment">// 或 import Something from &#x27;@/foo&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这样一个import使用的@的路径就配置好了，只要看到@或者<code>Clientapp/</code>它代表的就是<code>src/</code></p>
<h2 id="详细功能介绍"><a href="#详细功能介绍" class="headerlink" title="详细功能介绍"></a>详细功能介绍</h2><h3 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h3><p><strong>1.user-table.vue</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;filter-container&quot;&gt;</span><br><span class="line">      &lt;el-input</span><br><span class="line">        v-model=&quot;listQuery.username&quot;</span><br><span class="line">        placeholder=&quot;Title&quot;</span><br><span class="line">        style=&quot;width: 800px;&quot;</span><br><span class="line">        class=&quot;filter-item&quot;</span><br><span class="line">        @keyup.enter.native=&quot;handleFilter&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;el-button</span><br><span class="line">        v-waves</span><br><span class="line">        style=&quot;margin-left: 10px;&quot;</span><br><span class="line">        class=&quot;filter-item&quot;</span><br><span class="line">        type=&quot;primary&quot;</span><br><span class="line">        icon=&quot;el-icon-search&quot;</span><br><span class="line">        @click=&quot;handleFilter&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        搜索</span><br><span class="line">      &lt;/el-button&gt;</span><br><span class="line">      &lt;el-button</span><br><span class="line">        class=&quot;filter-item&quot;</span><br><span class="line">        style=&quot;margin-left: 10px;&quot;</span><br><span class="line">        type=&quot;primary&quot;</span><br><span class="line">        icon=&quot;el-icon-edit&quot;</span><br><span class="line">        @click=&quot;handleCreate&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        新增</span><br><span class="line">      &lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-table</span><br><span class="line">      v-loading=&quot;listLoading&quot;</span><br><span class="line">      :data=&quot;list&quot;</span><br><span class="line">      border</span><br><span class="line">      fit</span><br><span class="line">      highlight-current-row</span><br><span class="line">      style=&quot;width: 100%;&quot;</span><br><span class="line">      row-key=&quot;id&quot;</span><br><span class="line">      :tree-props=&quot;&#123; children: &#x27;children&#x27;, hasChildren: &#x27;hasChildren&#x27; &#125;&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        label=&quot;ID&quot;</span><br><span class="line">        prop=&quot;id&quot;</span><br><span class="line">        sortable=&quot;custom&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">        width=&quot;280&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.id &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;日期&quot; width=&quot;280px&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.createTime &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;用户名&quot; width=&quot;280px&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.username &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;!-- &lt;el-table-column label=&quot;密码&quot; width=&quot;280px&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;row.password&quot; :disabled=&quot;true&quot; show-password&gt;</span><br><span class="line">          &lt;/el-input&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt; --&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;邮箱&quot; width=&quot;298px&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.email &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;电话&quot; align=&quot;center&quot; width=&quot;280px&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.phone &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        label=&quot;操作&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">        width=&quot;250&quot;</span><br><span class="line">        class-name=&quot;small-padding fixed-width&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row, $index &#125;&quot;&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; @click=&quot;handleUpdate(row)&quot;&gt;</span><br><span class="line">            编辑</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            type=&quot;danger&quot;</span><br><span class="line">            @click=&quot;handleDelete(row, $index)&quot;</span><br><span class="line">            :disabled=&quot;name == row.username&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            删除</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line">    &lt;pagination</span><br><span class="line">      v-show=&quot;total &gt; 0&quot;</span><br><span class="line">      :total=&quot;total&quot;</span><br><span class="line">      :page.sync=&quot;listQuery.pageNum&quot;</span><br><span class="line">      :limit.sync=&quot;listQuery.pageSize&quot;</span><br><span class="line">      @pagination=&quot;getList&quot;</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-dialog :title=&quot;textMap[dialogStatus]&quot; :visible.sync=&quot;dialogFormVisible&quot;&gt;</span><br><span class="line">      &lt;el-form</span><br><span class="line">        ref=&quot;dataForm&quot;</span><br><span class="line">        :rules=&quot;rules&quot;</span><br><span class="line">        :model=&quot;temp&quot;</span><br><span class="line">        label-position=&quot;left&quot;</span><br><span class="line">        label-width=&quot;70px&quot;</span><br><span class="line">        style=&quot;width: 400px; margin-left:50px;&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;el-form-item label=&quot;用户名&quot; prop=&quot;username&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;temp.username&quot; /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item</span><br><span class="line">          label=&quot;密码&quot;</span><br><span class="line">          prop=&quot;password&quot;</span><br><span class="line">          v-if=&quot;textMap[dialogStatus] == &#x27;新增&#x27;&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;el-input v-model=&quot;temp.password&quot; show-password /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;邮箱&quot; prop=&quot;email&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;temp.email&quot; type=&quot;email&quot; /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;电话&quot; prop=&quot;phone&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;temp.phone&quot; /&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogFormVisible = false&quot;&gt;</span><br><span class="line">          取消</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">        &lt;el-button</span><br><span class="line">          type=&quot;primary&quot;</span><br><span class="line">          @click=&quot;dialogStatus === &#x27;create&#x27; ? createData() : updateData()&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          确认</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; fetchList, singleDel, addUser, updateUser &#125; from &quot;@/api/article&quot;;</span><br><span class="line">import store from &quot;../../store&quot;;</span><br><span class="line">import waves from &quot;@/directive/waves&quot;; //? 通用的方法</span><br><span class="line">import Pagination from &quot;@/components/Pagination&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;user-table&quot;,</span><br><span class="line">  components: &#123; Pagination &#125;,</span><br><span class="line">  //   一些自定义事件 用这个来绑定 是table具有一些自己定义好的功能</span><br><span class="line">  directives: &#123; waves &#125;,</span><br><span class="line"></span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      //* 表单数据 这里必须设置为空数组 不然会报错</span><br><span class="line">      list: [],</span><br><span class="line">      //   数据总数</span><br><span class="line">      total: 0,</span><br><span class="line">      //   是否显示加载的动画</span><br><span class="line">      listLoading: true,</span><br><span class="line">      // ! 分页的参数</span><br><span class="line">      listQuery: &#123;</span><br><span class="line">        pageNum: 1,</span><br><span class="line">        pageSize: 10,</span><br><span class="line">        username: &quot;&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      // ! 给弹出框进行数据初始化</span><br><span class="line">      temp: &#123;</span><br><span class="line">        username: undefined,</span><br><span class="line">        password: undefined,</span><br><span class="line">        email: undefined,</span><br><span class="line">        phone: undefined</span><br><span class="line">      &#125;,</span><br><span class="line">      //   控制弹出框的隐藏出现</span><br><span class="line">      dialogFormVisible: false,</span><br><span class="line">      //   用来判断是新增 还是编辑</span><br><span class="line">      dialogStatus: &quot;&quot;,</span><br><span class="line">      //   用来存储两种状态</span><br><span class="line">      textMap: &#123;</span><br><span class="line">        update: &quot;编辑&quot;,</span><br><span class="line">        create: &quot;新增&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      //   校验规则 保证用户名 密码和电话 是必填的</span><br><span class="line">      rules: &#123;</span><br><span class="line">        username: [</span><br><span class="line">          &#123; required: true, message: &quot;username is required&quot;, trigger: &quot;blur&quot; &#125;</span><br><span class="line">        ],</span><br><span class="line">        password: [</span><br><span class="line">          &#123; required: true, message: &quot;password is required&quot;, trigger: &quot;blur&quot; &#125;</span><br><span class="line">        ],</span><br><span class="line">        email: [</span><br><span class="line">          &#123;</span><br><span class="line">            required: true,</span><br><span class="line">            message: &quot;email is required&quot;,</span><br><span class="line">            trigger: &quot;blur&quot;,</span><br><span class="line">            validator: function(rule, value, callback) &#123;</span><br><span class="line">              if (</span><br><span class="line">                /^\w&#123;1,64&#125;@[a-z0-9\-]&#123;1,256&#125;(\.[a-z]&#123;2,6&#125;)&#123;1,2&#125;$/i.test(</span><br><span class="line">                  value</span><br><span class="line">                ) == false</span><br><span class="line">              ) &#123;</span><br><span class="line">                callback(new Error(&quot;邮箱格式错误&quot;));</span><br><span class="line">              &#125; else &#123;</span><br><span class="line">                callback();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        phone: [</span><br><span class="line">          &#123;</span><br><span class="line">            required: true,</span><br><span class="line">            message: &quot;phone is required&quot;,</span><br><span class="line">            trigger: &quot;blur&quot;,</span><br><span class="line">            validator: function(rule, value, callback) &#123;</span><br><span class="line">              if (/^1[34578]\d&#123;9&#125;$/.test(value) == false) &#123;</span><br><span class="line">                callback(new Error(&quot;手机号格式错误&quot;));</span><br><span class="line">              &#125; else &#123;</span><br><span class="line">                callback();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getList();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // ! 获取所有的用户</span><br><span class="line">    getList() &#123;</span><br><span class="line">      fetchList(this.listQuery).then(response =&gt; &#123;</span><br><span class="line">        this.list = response.data;</span><br><span class="line">        this.name = store.getters.name;</span><br><span class="line"></span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">          this.listLoading = false;</span><br><span class="line">        &#125;, 1.0 * 1000);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // ! 搜索的方法</span><br><span class="line">    handleFilter() &#123;</span><br><span class="line">      this.getList();</span><br><span class="line">    &#125;,</span><br><span class="line">    // ! 删除数据的方法</span><br><span class="line">    handleDelete(row, index) &#123;</span><br><span class="line">      var userID = &#123;</span><br><span class="line">        id: row.id</span><br><span class="line">      &#125;;</span><br><span class="line">      singleDel(userID).then(res =&gt; &#123;</span><br><span class="line">        if (res.code == 1) &#123;</span><br><span class="line">          this.$notify(&#123;</span><br><span class="line">            title: &quot;Success&quot;,</span><br><span class="line">            message: &quot;Delete Successfully&quot;,</span><br><span class="line">            type: &quot;success&quot;,</span><br><span class="line">            duration: 2000</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.$notify(&#123;</span><br><span class="line">            title: &quot;error&quot;,</span><br><span class="line">            message: &quot;Delete failed&quot;,</span><br><span class="line">            type: &quot;error&quot;,</span><br><span class="line">            duration: 2000</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        this.getList();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 重置表单</span><br><span class="line">    resetTemp() &#123;</span><br><span class="line">      this.temp = &#123;</span><br><span class="line">        username: undefined,</span><br><span class="line">        email: undefined,</span><br><span class="line">        phone: undefined,</span><br><span class="line">        password: undefined</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 新增按钮点击之后的反应</span><br><span class="line">    handleCreate() &#123;</span><br><span class="line">      this.resetTemp();</span><br><span class="line">      this.dialogStatus = &quot;create&quot;;</span><br><span class="line">      this.dialogFormVisible = true;</span><br><span class="line">      this.$nextTick(() =&gt; &#123;</span><br><span class="line">        this.$refs[&quot;dataForm&quot;].clearValidate();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // ! 这里是增加数据的方法</span><br><span class="line">    createData() &#123;</span><br><span class="line">      this.$refs[&quot;dataForm&quot;].validate(valid =&gt; &#123;</span><br><span class="line">        if (valid) &#123;</span><br><span class="line">          addUser(this.temp).then(res =&gt; &#123;</span><br><span class="line">            if (res.code == 1) &#123;</span><br><span class="line">              this.dialogFormVisible = false;</span><br><span class="line">              this.$notify(&#123;</span><br><span class="line">                title: &quot;Success&quot;,</span><br><span class="line">                message: &quot;create Successfully&quot;,</span><br><span class="line">                type: &quot;success&quot;,</span><br><span class="line">                duration: 2000</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$notify(&#123;</span><br><span class="line">                title: &quot;error&quot;,</span><br><span class="line">                message: &quot;created failed&quot;,</span><br><span class="line">                type: &quot;error&quot;,</span><br><span class="line">                duration: 2000</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            this.getList();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 更新数据的弹出框打开</span><br><span class="line">    handleUpdate(row) &#123;</span><br><span class="line">      this.temp = &#123;</span><br><span class="line">        id: row.id,</span><br><span class="line">        username: row.username,</span><br><span class="line">        email: row.email,</span><br><span class="line">        phone: row.phone</span><br><span class="line">      &#125;;</span><br><span class="line">      this.dialogStatus = &quot;update&quot;;</span><br><span class="line">      this.dialogFormVisible = true;</span><br><span class="line">      this.$nextTick(() =&gt; &#123;</span><br><span class="line">        this.$refs[&quot;dataForm&quot;].clearValidate();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // ! 更新数据的具体方法</span><br><span class="line">    updateData() &#123;</span><br><span class="line">      this.$refs[&quot;dataForm&quot;].validate(valid =&gt; &#123;</span><br><span class="line">        if (valid) &#123;</span><br><span class="line">          const tempData = Object.assign(this.temp, &#123;&#125;);</span><br><span class="line">          //  深度复制表单的值 并且赋值给tempData</span><br><span class="line">          updateUser(tempData).then(res =&gt; &#123;</span><br><span class="line">            if (res.code == 1) &#123;</span><br><span class="line">              this.dialogFormVisible = false;</span><br><span class="line">              this.$notify(&#123;</span><br><span class="line">                title: &quot;Success&quot;,</span><br><span class="line">                message: &quot;update Successfully&quot;,</span><br><span class="line">                type: &quot;success&quot;,</span><br><span class="line">                duration: 2000</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$notify(&#123;</span><br><span class="line">                title: &quot;error&quot;,</span><br><span class="line">                message: &quot;update failed&quot;,</span><br><span class="line">                type: &quot;error&quot;,</span><br><span class="line">                duration: 2000</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            this.getList();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>此页面的组件大部分都是来自于<code>element UI</code>的<code>table</code>和<code>form</code>组件的，核心内容就是表单展示数据，用对话框搭配表单来进行数据的增加以及修改，详细的<code>table</code>和<code>form</code>的属性还是见官方的文档。</p>
</li>
<li><p>页面一共由三部分组成，头部div，主体table模块，分页组件，这里引用的分页组件是对<code>elelement UI </code>的分页组件的二次开发和封装，原生的分页很好用，但是每次调用都需要复制代码，实在太过于繁琐，所以封装成了组件，参数传递方式和接受方式与官方一致，并无差异。</p>
</li>
<li><p>页面的设计结构：</p>
<ol>
<li>table是公用的部分，但是表单中的每一行数据都需要进行 <code>编辑和删除 </code>操作，所以这里使用了Vue中的作用域插槽<code>solt-scope</code>的方式，将编辑和删除的按钮遍历到表单的每一行；它的作用就是当点击的时候，拿到每一行对应的数据，方便进行下面的操作。</li>
<li>项目存在编辑和添加两个功能，所以需要一个弹出框来进行操作，这里我将两个功能统一使用一个对话框；为了防止出错，也减少了代码的编写量，只需要判断是点击哪个按钮打开的弹出框即可完成对应的逻辑操作。</li>
<li>编辑的对话框打开的时候，需要拿到数据展示，而新增数据的对话框打开，需要将对话框清空，方便操作者进行输入，也确保了数据的安全性。</li>
<li>这里使用了<code>Vuex</code>状态管理，来获取登录之后的用户名称，因为后台数据库不允许删除本人的数据，所以，当<code>vuex</code>中存入的用户名称与<code>table</code>中某一列的数据是吻合的，就将删除按钮禁用。</li>
</ol>
</li>
<li><p>页面的处理逻辑：CRUD的基本操作，函数调用接口<code>api</code>，判断接口返回的状态，进行操作提示。要注意的就是，这里每次操作后，一定要进行再次拉取数据库，也就是每个操作结束后，再执行一次查的操作，保证页面是最新的数据。</p>
</li>
<li><p><code>data</code>中的大部分数据以及函数方法，基本都写了注释，CRUD方法也基本上是最简答的<code>.then</code>链式调用处理<code>promise</code>函数的方法，只需要根据接口文档对返回的状态码判断即可。</p>
</li>
</ul>
<p><strong>2.api/artcle.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&quot;@/utils/request&quot;</span>;</span><br><span class="line"><span class="comment">// 查询所有</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchList</span>(<span class="params">query</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/api/user/readCas4Web&quot;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: query</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除用户</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">singleDel</span>(<span class="params">query</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/api/user/singleDel&quot;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: query</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 添加用户</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addUser</span>(<span class="params">query</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/api/user/create&quot;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: query</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 更新用户</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">updateUser</span>(<span class="params">query</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/api/user/update&quot;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: query</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获取所有的用户 不返回层级关系</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getAllUser</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/api/user/readAll&quot;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;post&quot;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 获取当前用户的权限</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getPermission</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/api/project/enableToSetManager&quot;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;post&quot;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 更换管理员的接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setManager</span>(<span class="params">query</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/api/project/SetManager&quot;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: query</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        这里是封装的<code>axios</code>模块对服务器进行<code>http</code>请求，<code>request</code>里面的对象就是axios的基本语法，包括了请求地址、请求方式、以及传参方式，这个js模块就是用户管理中所有<code>api</code></p>
<h3 id="项目管理"><a href="#项目管理" class="headerlink" title="项目管理"></a>项目管理</h3><p><strong>1.project-table.vue</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;filter-container&quot;&gt;</span><br><span class="line">      &lt;el-input</span><br><span class="line">        v-model=&quot;listQuery.name&quot;</span><br><span class="line">        placeholder=&quot;Title&quot;</span><br><span class="line">        style=&quot;width: 800px;&quot;</span><br><span class="line">        class=&quot;filter-item&quot;</span><br><span class="line">        @keyup.enter.native=&quot;handleFilter&quot;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;el-select</span><br><span class="line">        v-model=&quot;orgIds&quot;</span><br><span class="line">        clearable</span><br><span class="line">        placeholder=&quot;请选择组织&quot;</span><br><span class="line">        class=&quot;select&quot;</span><br><span class="line">        @change=&quot;changeOrganiazation&quot;</span><br><span class="line">        @clear=&quot;getAgain&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;el-option</span><br><span class="line">          v-for=&quot;item in options&quot;</span><br><span class="line">          :key=&quot;item.id&quot;</span><br><span class="line">          :label=&quot;item.label&quot;</span><br><span class="line">          :value=&quot;item.value&quot;</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;/el-option&gt;</span><br><span class="line">      &lt;/el-select&gt;</span><br><span class="line">      &lt;el-button</span><br><span class="line">        v-waves</span><br><span class="line">        style=&quot;margin-left: 10px;&quot;</span><br><span class="line">        class=&quot;filter-item&quot;</span><br><span class="line">        type=&quot;primary&quot;</span><br><span class="line">        icon=&quot;el-icon-search&quot;</span><br><span class="line">        @click=&quot;handleFilter&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        搜索</span><br><span class="line">      &lt;/el-button&gt;</span><br><span class="line">      &lt;el-button</span><br><span class="line">        class=&quot;filter-item&quot;</span><br><span class="line">        style=&quot;margin-left: 10px;&quot;</span><br><span class="line">        type=&quot;primary&quot;</span><br><span class="line">        icon=&quot;el-icon-edit&quot;</span><br><span class="line">        @click=&quot;handleCreate&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        增加</span><br><span class="line">      &lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-table</span><br><span class="line">      v-loading=&quot;listLoading&quot;</span><br><span class="line">      :data=&quot;list&quot;</span><br><span class="line">      border</span><br><span class="line">      fit</span><br><span class="line">      highlight-current-row</span><br><span class="line">      @sort-change=&quot;sortChange&quot;</span><br><span class="line">      style=&quot;width: 100%;&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        label=&quot;项目ID&quot;</span><br><span class="line">        prop=&quot;id&quot;</span><br><span class="line">        sortable=&quot;custom&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.id &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-table-column label=&quot;项目名称&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;项目地址&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.address &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;经度&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.longitude &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;纬度&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.latitude &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;项目介绍&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.description &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;储能容量(MW)&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.chargeCapacity &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot; 风机容量(MW)&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.windCapacity &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;光伏容量(MW)&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.pvCapacity &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;火电容量(MW)&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.fossilCapacity &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;储能功率(MWh)&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.chargeEnergy &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;项目网址&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.browserAddr &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;项目状态&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span v-if=&quot;row.state === 1&quot;&gt;正常&lt;/span&gt;</span><br><span class="line">          &lt;span v-if=&quot;row.state !== 1&quot;&gt;停机&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;项目类型&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.projectType &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;版本&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.version &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;管理员&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">          &lt;span&gt;&#123;&#123; row.creatorName &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        label=&quot;操作&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">        width=&quot;250&quot;</span><br><span class="line">        class-name=&quot;small-padding fixed-width&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;template slot-scope=&quot;&#123; row, $index &#125;&quot;&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; @click=&quot;handleUpdate(row)&quot;&gt;</span><br><span class="line">            编辑</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            type=&quot;danger&quot;</span><br><span class="line">            @click=&quot;handleDelete(row, $index)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            删除</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            type=&quot;primary&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            v-if=&quot;showAdmin == true&quot;</span><br><span class="line">            @click=&quot;handleAdmin(row)&quot;</span><br><span class="line">            &gt;设置管理员&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line">    &lt;pagination</span><br><span class="line">      v-show=&quot;total &gt; 0&quot;</span><br><span class="line">      :total=&quot;total&quot;</span><br><span class="line">      :page.sync=&quot;listQuery.pageNum&quot;</span><br><span class="line">      :limit.sync=&quot;listQuery.pageSize&quot;</span><br><span class="line">      @pagination=&quot;getList&quot;</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-dialog</span><br><span class="line">      :title=&quot;textMap[dialogStatus]&quot;</span><br><span class="line">      :visible.sync=&quot;dialogFormVisible&quot;</span><br><span class="line">      :close-on-click-modal=&quot;false&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form</span><br><span class="line">        ref=&quot;dataForm&quot;</span><br><span class="line">        :rules=&quot;rules&quot;</span><br><span class="line">        :model=&quot;temp&quot;</span><br><span class="line">        label-position=&quot;left&quot;</span><br><span class="line">        label-width=&quot;100px&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;el-row :gutter=&quot;20&quot;&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;</span><br><span class="line">            &gt;&lt;el-form-item</span><br><span class="line">              label=&quot;组织&quot;</span><br><span class="line">              prop=&quot;organizationId&quot;</span><br><span class="line">              style=&quot;width:100%&quot;</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;el-select</span><br><span class="line">                v-model=&quot;temp.organizationId&quot;</span><br><span class="line">                clearable</span><br><span class="line">                placeholder=&quot;请选择组织&quot;</span><br><span class="line">                style=&quot;width:100%&quot;</span><br><span class="line">              &gt;</span><br><span class="line">                &lt;el-option</span><br><span class="line">                  v-for=&quot;item in options&quot;</span><br><span class="line">                  :key=&quot;item.id&quot;</span><br><span class="line">                  :label=&quot;item.label&quot;</span><br><span class="line">                  :value=&quot;item.value&quot;</span><br><span class="line">                &gt;</span><br><span class="line">                &lt;/el-option&gt;</span><br><span class="line">              &lt;/el-select&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;项目名称&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;temp.name&quot; /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;经度&quot; prop=&quot;longitude&quot;&gt;</span><br><span class="line">              &lt;el-input</span><br><span class="line">                v-model=&quot;temp.longitude&quot;</span><br><span class="line">                oninput=&quot;value=value.replace(/[^0-9.]/g,&#x27;&#x27;)&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;项目地址&quot; prop=&quot;address&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;temp.address&quot; /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;储能容量&quot; prop=&quot;chargeCapacity&quot;&gt;</span><br><span class="line">              &lt;el-input</span><br><span class="line">                v-model=&quot;temp.chargeCapacity&quot;</span><br><span class="line">                oninput=&quot;value=value.replace(/[^0-9.]/g,&#x27;&#x27;)&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;风机容量&quot; prop=&quot;windCapacity&quot;&gt;</span><br><span class="line">              &lt;el-input</span><br><span class="line">                v-model=&quot;temp.windCapacity&quot;</span><br><span class="line">                oninput=&quot;value=value.replace(/[^0-9.]/g,&#x27;&#x27;)&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;火电容量&quot; prop=&quot;fossilCapacity&quot;&gt;</span><br><span class="line">              &lt;el-input</span><br><span class="line">                v-model=&quot;temp.fossilCapacity&quot;</span><br><span class="line">                oninput=&quot;value=value.replace(/[^0-9.]/g,&#x27;&#x27;)&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;版本&quot; prop=&quot;version&quot;&gt;</span><br><span class="line">              &lt;el-input</span><br><span class="line">                v-model=&quot;temp.version&quot;</span><br><span class="line">                oninput=&quot;value=value.replace(/[^\d]/g,&#x27;&#x27;)&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">          &lt;!-- -------------------------------------------------------------------- --&gt;</span><br><span class="line">          &lt;el-col :span=&quot;12&quot;&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;项目状态&quot; prop=&quot;state&quot;&gt;</span><br><span class="line">              &lt;el-select</span><br><span class="line">                v-model=&quot;temp.state&quot;</span><br><span class="line">                clearable</span><br><span class="line">                placeholder=&quot;请选择状态&quot;</span><br><span class="line">                style=&quot;width:100%&quot;</span><br><span class="line">              &gt;</span><br><span class="line">                &lt;el-option</span><br><span class="line">                  v-for=&quot;item in stateOptions&quot;</span><br><span class="line">                  :key=&quot;item.id&quot;</span><br><span class="line">                  :label=&quot;item.label&quot;</span><br><span class="line">                  :value=&quot;item.value&quot;</span><br><span class="line">                &gt;</span><br><span class="line">                &lt;/el-option&gt;</span><br><span class="line">              &lt;/el-select&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;项目介绍&quot; prop=&quot;description&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;temp.description&quot; /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;纬度&quot; prop=&quot;latitude&quot;&gt;</span><br><span class="line">              &lt;el-input</span><br><span class="line">                v-model=&quot;temp.latitude&quot;</span><br><span class="line">                oninput=&quot;value=value.replace(/[^0-9.]/g,&#x27;&#x27;)&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;项目网址&quot; prop=&quot;browserAddr&quot;&gt;</span><br><span class="line">              &lt;el-input</span><br><span class="line">                v-model=&quot;temp.browserAddr&quot;</span><br><span class="line">                onkeyup=&quot;value=value.replace(/[\u4E00-\u9FA5]/g,&#x27;&#x27;)&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;光伏容量&quot; prop=&quot;pvCapacity&quot;&gt;</span><br><span class="line">              &lt;el-input</span><br><span class="line">                v-model=&quot;temp.pvCapacity&quot;</span><br><span class="line">                oninput=&quot;value=value.replace(/[^0-9.]/g,&#x27;&#x27;)&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;储能功率&quot; prop=&quot;chargeEnergy&quot;&gt;</span><br><span class="line">              &lt;el-input</span><br><span class="line">                v-model=&quot;temp.chargeEnergy&quot;</span><br><span class="line">                oninput=&quot;value=value.replace(/[^0-9.]/g,&#x27;&#x27;)&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;el-form-item label=&quot;项目类型&quot; prop=&quot;projectType&quot;&gt;</span><br><span class="line">              &lt;el-input v-model=&quot;temp.projectType&quot; /&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">          &lt;/el-col&gt;</span><br><span class="line">        &lt;/el-row&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogFormVisible = false&quot;&gt;</span><br><span class="line">          取消</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">        &lt;el-button</span><br><span class="line">          type=&quot;primary&quot;</span><br><span class="line">          @click=&quot;dialogStatus === &#x27;create&#x27; ? createData() : updateData()&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          确认</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-dialog</span><br><span class="line">      title=&quot;修改管理员&quot;</span><br><span class="line">      :visible.sync=&quot;dialogFormAdmin&quot;</span><br><span class="line">      :close-on-click-modal=&quot;false&quot;</span><br><span class="line">      width=&quot;650px&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form</span><br><span class="line">        ref=&quot;adminForm&quot;</span><br><span class="line">        :model=&quot;adminTemp&quot;</span><br><span class="line">        :rules=&quot;adminRules&quot;</span><br><span class="line">        label-position=&quot;left&quot;</span><br><span class="line">        label-width=&quot;160px&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;el-form-item label=&quot;选择新的管理员&quot; prop=&quot;creator&quot; style=&quot;width:100%&quot;&gt;</span><br><span class="line">          &lt;el-select v-model=&quot;adminTemp.creator&quot; placeholder=&quot;请选择&quot;&gt;</span><br><span class="line">            &lt;el-option</span><br><span class="line">              v-for=&quot;item in adminOptions&quot;</span><br><span class="line">              :key=&quot;item.id&quot;</span><br><span class="line">              :label=&quot;item.label&quot;</span><br><span class="line">              :value=&quot;item.value&quot;</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;/el-option&gt;</span><br><span class="line">          &lt;/el-select&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogFormAdmin = false&quot;&gt;</span><br><span class="line">          取消</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;changeAdmin&quot;&gt;</span><br><span class="line">          确认</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;</span><br><span class="line">  getOrigan,</span><br><span class="line">  fetchList,</span><br><span class="line">  createProject,</span><br><span class="line">  updateProject,</span><br><span class="line">  deleteProject</span><br><span class="line">&#125; from &quot;@/api/project&quot;;</span><br><span class="line">import &#123; getAllUser, getPermission, setManager &#125; from &quot;@/api/article&quot;;</span><br><span class="line">import waves from &quot;@/directive/waves&quot;; //? 通用的方法</span><br><span class="line">import Pagination from &quot;@/components/Pagination&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;project-table&quot;,</span><br><span class="line">  components: &#123; Pagination &#125;,</span><br><span class="line">  //   一些自定义事件 用这个来绑定 是table具有一些自己定义好的功能</span><br><span class="line">  directives: &#123; waves &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      //   暂存 组织的id</span><br><span class="line">      orgIds: &quot;&quot;,</span><br><span class="line">      //   暂存 组织的结构</span><br><span class="line">      options: [],</span><br><span class="line">      stateOptions: [</span><br><span class="line">        &#123;</span><br><span class="line">          value: 0,</span><br><span class="line">          label: &quot;不能使用&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          value: 1,</span><br><span class="line">          label: &quot;运行&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          value: 2,</span><br><span class="line">          label: &quot;非运行&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          value: 3,</span><br><span class="line">          label: &quot;离线&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      adminOptions: [],</span><br><span class="line">      //* 表单数据 这里必须设置为空数组 不然会报错</span><br><span class="line">      list: [],</span><br><span class="line">      //   数据总数</span><br><span class="line">      total: 0,</span><br><span class="line">      //   是否显示加载的动画</span><br><span class="line">      listLoading: true,</span><br><span class="line">      // ! 分页的参数</span><br><span class="line">      listQuery: &#123;</span><br><span class="line">        orgIds: [],</span><br><span class="line">        name: &quot;&quot;,</span><br><span class="line">        pageNum: 1,</span><br><span class="line">        pageSize: 10</span><br><span class="line">      &#125;,</span><br><span class="line">      // ! 给弹出框进行数据初始化</span><br><span class="line">      temp: &#123;</span><br><span class="line">        name: undefined,</span><br><span class="line">        state: undefined,</span><br><span class="line">        address: undefined,</span><br><span class="line">        description: undefined,</span><br><span class="line">        longitude: undefined,</span><br><span class="line">        latitude: undefined,</span><br><span class="line">        organizationId: undefined,</span><br><span class="line">        browserAddr: undefined,</span><br><span class="line">        chargeCapacity: undefined,</span><br><span class="line">        pvCapacity: undefined,</span><br><span class="line">        windCapacity: undefined,</span><br><span class="line">        chargeEnergy: undefined,</span><br><span class="line">        fossilCapacity: undefined,</span><br><span class="line">        projectType: undefined,</span><br><span class="line">        version: undefined</span><br><span class="line">      &#125;,</span><br><span class="line">      adminTemp: &#123;</span><br><span class="line">        id: &quot;&quot;,</span><br><span class="line">        creator: &quot;&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      showAdmin: false,</span><br><span class="line">      //   控制弹出框的隐藏出现</span><br><span class="line">      dialogFormVisible: false,</span><br><span class="line">      dialogFormAdmin: false,</span><br><span class="line">      //   用来判断是新增 还是编辑</span><br><span class="line">      dialogStatus: &quot;&quot;,</span><br><span class="line">      //   用来存储两种状态</span><br><span class="line">      textMap: &#123;</span><br><span class="line">        update: &quot;编辑&quot;,</span><br><span class="line">        create: &quot;新增&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      //   校验规则 保证用户名 密码和电话 是必填的</span><br><span class="line">      rules: &#123;</span><br><span class="line">        name: [</span><br><span class="line">          &#123; required: true, message: &quot;name is required&quot;, trigger: &quot;blur&quot; &#125;</span><br><span class="line">        ],</span><br><span class="line">        state: [</span><br><span class="line">          &#123; required: true, message: &quot;state is required&quot;, trigger: &quot;change&quot; &#125;</span><br><span class="line">        ],</span><br><span class="line">        organizationId: [</span><br><span class="line">          &#123; required: true, message: &quot;orgIds is required&quot;, trigger: &quot;change&quot; &#125;</span><br><span class="line">        ],</span><br><span class="line">        description: [</span><br><span class="line">          &#123;</span><br><span class="line">            required: true,</span><br><span class="line">            message: &quot;description is required&quot;,</span><br><span class="line">            trigger: &quot;blur&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        longitude: [</span><br><span class="line">          &#123;</span><br><span class="line">            required: true,</span><br><span class="line">            message: &quot;longitude is required&quot;,</span><br><span class="line">            trigger: &quot;blur&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        latitude: [</span><br><span class="line">          &#123; required: true, message: &quot;latitude is required&quot;, trigger: &quot;blur&quot; &#125;</span><br><span class="line">        ],</span><br><span class="line">        projectType: [</span><br><span class="line">          &#123;</span><br><span class="line">            required: true,</span><br><span class="line">            message: &quot;projectType is required&quot;,</span><br><span class="line">            trigger: &quot;blur&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        address: [</span><br><span class="line">          &#123; required: true, message: &quot;address is required&quot;, trigger: &quot;blur&quot; &#125;</span><br><span class="line">        ],</span><br><span class="line">        version: [</span><br><span class="line">          &#123; required: true, message: &quot;version is required&quot;, trigger: &quot;blur&quot; &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      adminRules: &#123;</span><br><span class="line">        creator: [</span><br><span class="line">          &#123; required: true, message: &quot;user is required&quot;, trigger: &quot;change&quot; &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getList();</span><br><span class="line">    this.handleOrigan();</span><br><span class="line">    this.handlePermission();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 判断登录用户是否有设置管理员的权限</span><br><span class="line">    handlePermission() &#123;</span><br><span class="line">      getPermission().then(res =&gt; &#123;</span><br><span class="line">        if (res.code == 1) &#123;</span><br><span class="line">          this.showAdmin = res.data;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          return false;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    //! 获取所有的组织</span><br><span class="line">    handleOrigan() &#123;</span><br><span class="line">      getOrigan(&#123;&#125;).then(res =&gt; &#123;</span><br><span class="line">        const retData = res.data;</span><br><span class="line">        let arrList = [];</span><br><span class="line">        for (let i = 0; i &lt; retData.length; i++) &#123;</span><br><span class="line">          let retObj = &#123;&#125;;</span><br><span class="line">          retObj.value = retData[i].id;</span><br><span class="line">          retObj.label = retData[i].name;</span><br><span class="line">          arrList[i] = retObj;</span><br><span class="line">        &#125;</span><br><span class="line">        this.options = arrList;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // ! 获取所有的项目</span><br><span class="line">    getList() &#123;</span><br><span class="line">      fetchList(this.listQuery).then(res =&gt; &#123;</span><br><span class="line">        this.list = res.data.records;</span><br><span class="line"></span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">          this.listLoading = false;</span><br><span class="line">        &#125;, 1.0 * 1000);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // ! 选中组织后更新数据</span><br><span class="line">    changeOrganiazation(tartget) &#123;</span><br><span class="line">      if (tartget) &#123;</span><br><span class="line">        const arrList = [];</span><br><span class="line">        arrList.push(tartget);</span><br><span class="line">        this.listQuery.orgIds = arrList;</span><br><span class="line">        this.getList();</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this.listQuery.orgIds = [];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // ! 搜索的方法</span><br><span class="line">    handleFilter() &#123;</span><br><span class="line">      this.getList();</span><br><span class="line">    &#125;,</span><br><span class="line">    // *  清空选项后的方法</span><br><span class="line">    getAgain() &#123;</span><br><span class="line">      this.getList();</span><br><span class="line">    &#125;,</span><br><span class="line">    // ! 删除数据的方法</span><br><span class="line">    handleDelete(row, index) &#123;</span><br><span class="line">      var projectID = &#123;</span><br><span class="line">        ids: [row.id]</span><br><span class="line">      &#125;;</span><br><span class="line">      deleteProject(projectID).then(res =&gt; &#123;</span><br><span class="line">        if (res.code == 1) &#123;</span><br><span class="line">          this.$notify(&#123;</span><br><span class="line">            title: &quot;Success&quot;,</span><br><span class="line">            message: &quot;Delete Successfully&quot;,</span><br><span class="line">            type: &quot;success&quot;,</span><br><span class="line">            duration: 2000</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.$notify(&#123;</span><br><span class="line">            title: &quot;error&quot;,</span><br><span class="line">            message: &quot;Delete failed&quot;,</span><br><span class="line">            type: &quot;error&quot;,</span><br><span class="line">            duration: 2000</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        this.getList();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 重置表单</span><br><span class="line">    resetTemp() &#123;</span><br><span class="line">      this.temp = &#123;</span><br><span class="line">        name: undefined,</span><br><span class="line">        state: undefined,</span><br><span class="line">        address: undefined,</span><br><span class="line">        description: undefined,</span><br><span class="line">        longitude: undefined,</span><br><span class="line">        latitude: undefined,</span><br><span class="line">        organizationId: undefined,</span><br><span class="line">        browserAddr: undefined,</span><br><span class="line">        chargeCapacity: undefined,</span><br><span class="line">        pvCapacity: undefined,</span><br><span class="line">        windCapacity: undefined,</span><br><span class="line">        chargeEnergy: undefined,</span><br><span class="line">        fossilCapacity: undefined,</span><br><span class="line">        projectType: undefined,</span><br><span class="line">        version: undefined</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 新增按钮点击之后的反应</span><br><span class="line">    handleCreate() &#123;</span><br><span class="line">      this.resetTemp();</span><br><span class="line">      this.dialogStatus = &quot;create&quot;;</span><br><span class="line">      this.dialogFormVisible = true;</span><br><span class="line">      this.$nextTick(() =&gt; &#123;</span><br><span class="line">        this.$refs[&quot;dataForm&quot;].clearValidate();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // ! 这里是增加数据的方法</span><br><span class="line">    createData() &#123;</span><br><span class="line">      this.$refs[&quot;dataForm&quot;].validate(valid =&gt; &#123;</span><br><span class="line">        if (valid) &#123;</span><br><span class="line">          console.log(this.temp);</span><br><span class="line">          createProject(this.temp).then(res =&gt; &#123;</span><br><span class="line">            if (res.code == 1) &#123;</span><br><span class="line">              this.dialogFormVisible = false;</span><br><span class="line">              this.$notify(&#123;</span><br><span class="line">                title: &quot;Success&quot;,</span><br><span class="line">                message: &quot;create Successfully&quot;,</span><br><span class="line">                type: &quot;success&quot;,</span><br><span class="line">                duration: 2000</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                showClose: true,</span><br><span class="line">                message: &quot;新增失败&quot;,</span><br><span class="line">                type: &quot;error&quot;</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            this.getList();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 更新数据的弹出框打开</span><br><span class="line">    handleUpdate(row) &#123;</span><br><span class="line">      this.temp = &#123;</span><br><span class="line">        id: row.id,</span><br><span class="line">        name: row.name,</span><br><span class="line">        state: row.state,</span><br><span class="line">        address: row.address,</span><br><span class="line">        description: row.description,</span><br><span class="line">        longitude: row.longitude,</span><br><span class="line">        latitude: row.latitude,</span><br><span class="line">        organizationId: row.organizationId,</span><br><span class="line">        browserAddr: row.browserAddr,</span><br><span class="line">        chargeCapacity: row.chargeCapacity,</span><br><span class="line">        pvCapacity: row.pvCapacity,</span><br><span class="line">        windCapacity: row.windCapacity,</span><br><span class="line">        chargeEnergy: row.chargeEnergy,</span><br><span class="line">        fossilCapacity: row.fossilCapacity,</span><br><span class="line">        projectType: row.projectType,</span><br><span class="line">        version: row.version</span><br><span class="line">      &#125;;</span><br><span class="line">      this.dialogStatus = &quot;update&quot;;</span><br><span class="line">      this.dialogFormVisible = true;</span><br><span class="line">      this.$nextTick(() =&gt; &#123;</span><br><span class="line">        this.$refs[&quot;dataForm&quot;].clearValidate();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // ! 更新数据的具体方法</span><br><span class="line">    updateData() &#123;</span><br><span class="line">      this.$refs[&quot;dataForm&quot;].validate(valid =&gt; &#123;</span><br><span class="line">        if (valid) &#123;</span><br><span class="line">          const tempData = Object.assign(this.temp, &#123;&#125;);</span><br><span class="line">          //    深度复制表单的值 并且赋值给tempData</span><br><span class="line">          updateProject(tempData).then(res =&gt; &#123;</span><br><span class="line">            if (res.code == 1) &#123;</span><br><span class="line">              this.dialogFormVisible = false;</span><br><span class="line">              this.$notify(&#123;</span><br><span class="line">                title: &quot;Success&quot;,</span><br><span class="line">                message: &quot;update Successfully&quot;,</span><br><span class="line">                type: &quot;success&quot;,</span><br><span class="line">                duration: 2000</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$notify(&#123;</span><br><span class="line">                title: &quot;error&quot;,</span><br><span class="line">                message: &quot;update failed&quot;,</span><br><span class="line">                type: &quot;error&quot;,</span><br><span class="line">                duration: 2000</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            this.getList();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 点击如果是id这一列 就根据order进行排序 </span><br><span class="line">    sortChange(data) &#123;</span><br><span class="line">      const &#123; prop, order &#125; = data;</span><br><span class="line">      if (prop === &quot;id&quot;) &#123;</span><br><span class="line">        this.sortByID(order);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 如果order是升序就 asc 如果是降序就 desc</span><br><span class="line">    sortByID(order) &#123;</span><br><span class="line">      if (order === &quot;ascending&quot;) &#123;</span><br><span class="line">    // 这里我测试过了  好像直接用sort()方法也是默认用id进行排序 可以达到目的</span><br><span class="line">          console.log(this.list.sort());</span><br><span class="line">        this.list.sort(this.ascending(&quot;id&quot;));</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this.list.sort(this.descending(&quot;id&quot;));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 升序方法</span><br><span class="line">    ascending(prop) &#123;</span><br><span class="line">      return function(a, b) &#123;</span><br><span class="line">        var value1 = a[prop];</span><br><span class="line">        var value2 = b[prop];</span><br><span class="line">        return value1 - value2;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 降序方法</span><br><span class="line">    descending(prop) &#123;</span><br><span class="line">      return function(a, b) &#123;</span><br><span class="line">        var value1 = a[prop];</span><br><span class="line">        var value2 = b[prop];</span><br><span class="line">        return value2 - value1;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 修改管理员的弹出窗口</span><br><span class="line">    handleAdmin(row) &#123;</span><br><span class="line">      this.dialogFormAdmin = true;</span><br><span class="line">      this.adminTemp = &#123;</span><br><span class="line">        id: row.id,</span><br><span class="line">        creator: &quot;&quot;</span><br><span class="line">      &#125;;</span><br><span class="line">      getAllUser().then(res =&gt; &#123;</span><br><span class="line">        console.log(res.data);</span><br><span class="line">        const allUser = res.data;</span><br><span class="line">        let retData = [];</span><br><span class="line">        for (let i = 0; i &lt; allUser.length; i++) &#123;</span><br><span class="line">          let retObj = &#123;&#125;;</span><br><span class="line">          retObj.value = allUser[i].id;</span><br><span class="line">          retObj.label = allUser[i].username;</span><br><span class="line">          retData[i] = retObj;</span><br><span class="line">        &#125;</span><br><span class="line">        this.adminOptions = retData;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 具体修改成功</span><br><span class="line">    changeAdmin() &#123;</span><br><span class="line">      console.log(this.adminTemp);</span><br><span class="line">      this.$refs[&quot;adminForm&quot;].validate(valid =&gt; &#123;</span><br><span class="line">        if (valid) &#123;</span><br><span class="line">          setManager(this.adminTemp).then(res =&gt; &#123;</span><br><span class="line">            if (res.code == 1) &#123;</span><br><span class="line">              this.dialogFormAdmin = false;</span><br><span class="line">              this.$notify(&#123;</span><br><span class="line">                title: &quot;Success&quot;,</span><br><span class="line">                message: &quot;alter Successfully&quot;,</span><br><span class="line">                type: &quot;success&quot;,</span><br><span class="line">                duration: 2000</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                showClose: true,</span><br><span class="line">                message: &quot;alter failed&quot;,</span><br><span class="line">                type: &quot;error&quot;</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            this.getList();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.select &#123;</span><br><span class="line">  margin-left: 10px;</span><br><span class="line">  top: -4px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>此页面的结构和样式基本上与用户管理页面是一样的，只是接口略有不同。</li>
<li>页面的设计结构：<ol>
<li>在此页面，与用户管理页面不同之处是，多设计了一个对话框框，用来更换项目的管理员；这里个功能涉及到了三个新的接口，一个是获取所有的用户，（不包含级联关系），用来做下拉框数据；二是获取当前登录用户的权限，只有<code>admin</code>有权限来更换项目的管理员，如果是其他的管理员是没有权限将项目转接给别的管理员的；最后就是设置项目的管理员的接口，需要传递<code>项目ID和管理员ID</code>。</li>
<li>此页面，用了两个弹出框，所以要设置不同的标记符来区分弹出框，防止重复弹出的<code>bug</code>;</li>
<li>本页面，用到了大量的正则表达式来限制输入框输入的内容，这是因为数据库要求，很多输入框必须是数字或者汉字或者是字母等等</li>
<li>本页面，上方有两个筛选框，是同一个接口，但是如果传递了组织就会展示组织下对应的项目，如果没有传组织就会展示全部；搜索也是一样的，接口允许将两个值传入或者两个值都为空值！</li>
<li>在本页面，<code>table</code>新添加了一个排序的方法，会按照ID来进行升序或者降序排列，核心就是利用sort方法对每一个数组对象中的key进行大小对比，之后再次返回数组对象达到排序的目的。</li>
</ol>
</li>
<li>页面的处理逻辑（与用户管理一样）：CRUD的基本操作，函数调用接口<code>api</code>，判断接口返回的状态，进行操作提示。要注意的就是，这里每次操作后，一定要进行再次拉取数据库，也就是每个操作结束后，再执行一次查的操作，保证页面是最新的数据。</li>
<li><code>data</code>中的大部分数据以及函数方法，基本都写了注释，CRUD方法也基本上是最简答的<code>.then</code>链式调用处理<code>promise</code>函数的方法，只需要根据接口文档对返回的状态码判断即可。</li>
</ul>
<p><strong>2.@/api/project.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&quot;@/utils/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取组织</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getOrigan</span>(<span class="params">query</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/api/org/readAll&quot;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: query</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 查询所有的项目列表</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchList</span>(<span class="params">query</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/api/project/read4Web&quot;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: query</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建项目</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createProject</span>(<span class="params">query</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/api/project/create&quot;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: query</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 更新项目信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">updateProject</span>(<span class="params">query</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/api/project/update&quot;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: query</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除项目</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteProject</span>(<span class="params">query</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;/api/project/delete&quot;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>: query</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Vuex介绍与使用"><a href="#Vuex介绍与使用" class="headerlink" title="Vuex介绍与使用"></a>Vuex介绍与使用</h2><p>​        本项目也使用到了Vuex，全局状态管理机制，当然这个插件的使用，不仅仅是为了全局状态的管理，它里面还集成了很多的异步方法，可以用来控制全局变量，以及整个项目中不同组件的通信，也就是说它可以完成组件间的通信，通过改变某些全局变量的值和获取他们来达到目的。</p>
<h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">|--store								<span class="comment">#存放vuex的文件夹</span></span><br><span class="line">│   └── modules             			<span class="comment"># model文件夹</span></span><br><span class="line">│   	├── app.js                      <span class="comment"># model_app</span></span><br><span class="line">│   	├── errorLog.js             	<span class="comment"># model_errorLog</span></span><br><span class="line">│   	├── permission.js             	<span class="comment"># model_permission</span></span><br><span class="line">│   	├── settings.js             	<span class="comment"># model_settings</span></span><br><span class="line">│   	├── tagsView.js             	<span class="comment"># model_tagView</span></span><br><span class="line">│   	├── user.js             		<span class="comment"># model_user</span></span><br><span class="line">│   └── getters.js          			<span class="comment"># 获取状态的方法</span></span><br><span class="line">│   └── index.js            			<span class="comment"># vuex入口文件</span></span><br></pre></td></tr></table></figure>

<p>​        以上是本项目的<code>Vuex</code>，当然，因为项目是<code>Vue2.6.+</code>版本,所以还是沿用之前的<code>vuex</code>的项目结构，最新版本的<code>vuex</code>将其不放在<code>src</code>的根目录下，而是选择性的放在每一个<code>modules components</code>里面，或者也可以理解为给每一个组件文件夹的根目录创建一个<code>store</code>。</p>
<h3 id="用法示例"><a href="#用法示例" class="headerlink" title="用法示例"></a>用法示例</h3><p>​        需要先介绍，<code>index.js</code>和<code>getters.js</code>，见下方代码块：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//	getters对象的定义</span></span><br><span class="line"><span class="comment">//	通过箭头函数来引入每一个状态</span></span><br><span class="line"><span class="comment">//	全局调用时 只需要 this.$store.getters.XXX即可获取状态</span></span><br><span class="line"><span class="comment">//	state只是一个变量 具体的内容还是要看这个状态变量 属于哪个modules 然后再用state.modules.属性来获取值</span></span><br><span class="line"><span class="comment">//  将每一个modules的状态，通过这个对象来打包到一起，保证后续全局使用的方便。</span></span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">  <span class="attr">sidebar</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.app.sidebar,</span><br><span class="line">  <span class="attr">size</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.app.size,</span><br><span class="line">  <span class="attr">device</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.app.device,</span><br><span class="line">  <span class="attr">visitedViews</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.tagsView.visitedViews,</span><br><span class="line">  <span class="attr">cachedViews</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.tagsView.cachedViews,</span><br><span class="line">  <span class="attr">token</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.user.token, <span class="comment">//VueX 中token的值</span></span><br><span class="line">  <span class="attr">avatar</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.user.avatar,</span><br><span class="line">  <span class="attr">name</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.user.name,</span><br><span class="line">  <span class="attr">introduction</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.user.introduction,</span><br><span class="line">  <span class="attr">roles</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.user.roles,</span><br><span class="line">  <span class="attr">permission_routes</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.permission.routes,</span><br><span class="line">  <span class="attr">errorLogs</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.errorLog.logs</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> getters;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">源码路径：@/store/index.js</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">&quot;./getters&quot;</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Vuex);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义modules的文件夹</span></span><br><span class="line"><span class="comment">// 一个webpack的api,通过执行require.context函数获取一个特定的上下文,主要用来实现自动化导入模块,</span></span><br><span class="line"><span class="comment">// 在前端工程中,如果遇到从一个文件夹引入很多模块的情况,可以使用这个api,它会遍历文件夹中的指定文件,然后自动导入,使得不需要每次显式的调用import导入模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 语法：require.context(directory, useSubdirectories = false, regExp = /^.//);</span></span><br><span class="line"><span class="comment">// 这里返回的是一个函数</span></span><br><span class="line"><span class="comment">// 1.directory 读取文件的路径</span></span><br><span class="line"><span class="comment">// 2.useSubdirectories 是否遍历文件的子目录</span></span><br><span class="line"><span class="comment">// 3.regExp 是匹配文件的正则</span></span><br><span class="line"><span class="keyword">const</span> modulesFiles = <span class="built_in">require</span>.context(<span class="string">&quot;./modules&quot;</span>, <span class="literal">true</span>, <span class="regexp">/\.js$/</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里会自动引用所有VueX 需要的state action mutation模块</span></span><br><span class="line"><span class="comment">// .keys() 这个方法就是拿到一个数组 是有文件夹下面所有的.js模块构成的字符串数组</span></span><br><span class="line"><span class="comment">// reduce() 为数组中的每一个元素依次执行回调函数</span></span><br><span class="line"><span class="comment">// 这个函数的就是获取文件夹下面所有的 模块 根据名称和路径 将其内部的函数进行加载 重构</span></span><br><span class="line"><span class="comment">// 每一个js文件里面的东西 都会被这个函数方法加载</span></span><br><span class="line"><span class="keyword">const</span> modules = modulesFiles.keys().reduce(<span class="function">(<span class="params">modules, modulePath</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 这一步 就是将 &#x27;./app.js&#x27;变成了&#x27;app&#x27;  为下面modules对象中key的使用做准备</span></span><br><span class="line">  <span class="keyword">const</span> moduleName = modulePath.replace(<span class="regexp">/^\.\/(.*)\.\w+$/</span>, <span class="string">&quot;$1&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 遍历数组每一项,调用modulesFiles函数传入遍历的元素返回一个Modules模块</span></span><br><span class="line">  <span class="keyword">const</span> value = modulesFiles(modulePath);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 因为路径是用export default导出的,所以在Module模块的default属性中获取到我导出的内容(即路由的结构),类似这种样子</span></span><br><span class="line">  <span class="comment">// 给modules数组赋值并且返回去 至此所有的模块以及对应的Vuex函数模块都被加载完成</span></span><br><span class="line">  modules[moduleName] = value.default;</span><br><span class="line">  <span class="keyword">return</span> modules;</span><br><span class="line">&#125;, &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里将所有的modules和getters 挂载在store上</span></span><br><span class="line"><span class="comment">// 不挂载Vuex什么读取不到</span></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  modules,</span><br><span class="line">  getters</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​        这里巧妙地使用了<code>webpack</code>的<code>import</code>特性以及原生的<code>api</code>,通过<code>require</code>函数实现了批量导入文件夹下面的多个模块以及模块里的内容,具体的代码含义见上方代码块注释，当有了getters和module后，Vuex就可以正常进行工作了，这里是必备的两个条件。具体文档见官方。</p>
<h3 id="用户模块的管理（示例）"><a href="#用户模块的管理（示例）" class="headerlink" title="用户模块的管理（示例）"></a>用户模块的管理（示例）</h3><p>​        这里就是一个<code>modules</code>的示例，具体的它的执行逻辑和方法，都在上面权限管理里面讲述过了它的执行逻辑，以及是如何配合<code>permission.js</code>进行权限控制的,其他的<code>模块</code>大同小异，都是在控制其组件对应的状态和方法.<br>​        总结一下：同步方法多写于<code>api</code>回调函数之中，用来设置状态标记符;而异步方法多用于<code>api</code>回调结束之后，完成某个业务逻辑之后，对状态的异步改变；在使用方法的时候一定要明白什么什么方法应该写成同步函数，而什么方法又应该写成异步函数，异步调用的函数中也是可以包含同步函数的，尽量让<code>commit</code>写在对应<code>modules</code>的异步方法中，这样便于管理也不会很乱，不要将<code>commit</code>也写在组件的调用方法中，易读性差且耦合度较高，不移维护。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里是引用接口 暂时只有登录的接口 就只用登录即可</span></span><br><span class="line"><span class="keyword">import</span> &#123; login &#125; <span class="keyword">from</span> <span class="string">&quot;@/api/user&quot;</span>;</span><br><span class="line"><span class="comment">// 引用鉴权方法 获取token ，设置token 和 移除token的三个方法</span></span><br><span class="line"><span class="keyword">import</span> &#123; getToken,setToken, removeToken, getTokens,removeTokens &#125; <span class="keyword">from</span> <span class="string">&quot;@/utils/auth&quot;</span>;</span><br><span class="line"><span class="comment">// 这里是路由方法，一个是resetRouter是用来重置路由跳转的</span></span><br><span class="line"><span class="keyword">import</span> router, &#123; resetRouter &#125; <span class="keyword">from</span> <span class="string">&quot;@/router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Cookies <span class="keyword">from</span> <span class="string">&quot;js-cookie&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里是状态设置 state的初始化  可以理解为状态对象实例</span></span><br><span class="line"><span class="comment">// 这里的Token由于存在两个 所以需要 拿鉴权方法 判断</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">token</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (getToken()) &#123;</span><br><span class="line">      <span class="keyword">return</span> getToken();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> getTokens();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="comment">//    当我们想要动态绑定img的src的时候，Vue数据绑图片的相对路径或者绝对路径的时候，必须要require</span></span><br><span class="line">  <span class="attr">avatar</span>: <span class="built_in">require</span>(<span class="string">&quot;../../assets/image/header.jpeg&quot;</span>),</span><br><span class="line">  <span class="attr">introduction</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">roles</span>: []</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里是 mutation  可以理解为实例对应的方法</span></span><br><span class="line"><span class="comment">// mutation下面全部都是同步执行的方法(sync)</span></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="attr">SET_TOKEN</span>: <span class="function">(<span class="params">state, token</span>) =&gt;</span> &#123;</span><br><span class="line">    state.token = token;</span><br><span class="line">    sessionStorage.setItem(<span class="string">&quot;token&quot;</span>, token);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">SET_INTRODUCTION</span>: <span class="function">(<span class="params">state, introduction</span>) =&gt;</span> &#123;</span><br><span class="line">    state.introduction = introduction;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">SET_NAME</span>: <span class="function">(<span class="params">state, name</span>) =&gt;</span> &#123;</span><br><span class="line">    state.name = name;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">SET_AVATAR</span>: <span class="function">(<span class="params">state, avatar</span>) =&gt;</span> &#123;</span><br><span class="line">    state.avatar = avatar;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">SET_ROLES</span>: <span class="function">(<span class="params">state, roles</span>) =&gt;</span> &#123;</span><br><span class="line">    state.roles = roles;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果是异步(async)改变状态 就是操作action</span></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="comment">// user login</span></span><br><span class="line">  <span class="comment">// 这里的commit是简略写法，就是为了省去context这个直接进行commit调用</span></span><br><span class="line">  <span class="comment">// 第一个login是vueX中定义的方法，第二个login是api中定义的方法</span></span><br><span class="line">  <span class="function"><span class="title">login</span>(<span class="params">&#123; commit &#125;, userInfo</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//  解构赋值 将username和password分别赋值</span></span><br><span class="line">    <span class="keyword">const</span> &#123; username, password &#125; = userInfo;</span><br><span class="line">    <span class="comment">//  将用户名和密码存到本地缓存中</span></span><br><span class="line">    <span class="built_in">window</span>.localStorage.setItem(<span class="string">&quot;userInfo&quot;</span>, <span class="built_in">JSON</span>.stringify(userInfo));</span><br><span class="line">    <span class="comment">// 这里返回的是一个promise对象</span></span><br><span class="line">    <span class="comment">// 如果成功就执行resolve()</span></span><br><span class="line">    <span class="comment">// 失败就reject(error) 将错误返回去</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      login(&#123; <span class="attr">username</span>: username.trim(), <span class="attr">password</span>: password &#125;)</span><br><span class="line">        .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">//   如果登录成功，就把接口中获取到的Token存储</span></span><br><span class="line">          <span class="comment">//   这里一定是要有token的 如果不设置token 是会报错的 无法登录成功的</span></span><br><span class="line">          <span class="keyword">let</span> token = response.data.Authorization;</span><br><span class="line">          <span class="comment">//   commit是在调用mutations里面的方法</span></span><br><span class="line">          commit(<span class="string">&quot;SET_TOKEN&quot;</span>, token); <span class="comment">//   这里是同步操作</span></span><br><span class="line">          setToken(token); <span class="comment">//   在更新store的同时 将token存入cookie中</span></span><br><span class="line">          resolve();</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">          reject(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get user info</span></span><br><span class="line">  <span class="function"><span class="title">getInfo</span>(<span class="params">&#123; commit, state &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//   这里直接获取本地的存储登录信息</span></span><br><span class="line">      <span class="comment">//   这个方法会在路由守卫页面被调用</span></span><br><span class="line">      <span class="keyword">var</span> data = <span class="built_in">JSON</span>.parse(<span class="built_in">window</span>.localStorage.getItem(<span class="string">&quot;userInfo&quot;</span>));</span><br><span class="line">      <span class="keyword">if</span> (!data) &#123;</span><br><span class="line">        reject(<span class="string">&quot;登陆失败，重新登陆&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//   设置权限为管理员权限</span></span><br><span class="line">      commit(<span class="string">&quot;SET_ROLES&quot;</span>, [<span class="string">&quot;admin&quot;</span>]);</span><br><span class="line"></span><br><span class="line">      resolve(data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// user logout 没有接口就先只清除token</span></span><br><span class="line">  <span class="function"><span class="title">logout</span>(<span class="params">&#123; commit, state, dispatch &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//  将store中的token清空</span></span><br><span class="line">      <span class="comment">//  将角色也清空</span></span><br><span class="line">      commit(<span class="string">&quot;SET_TOKEN&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">      commit(<span class="string">&quot;SET_ROLES&quot;</span>, []);</span><br><span class="line">      <span class="comment">//  移除浏览器中的token</span></span><br><span class="line">      removeToken();</span><br><span class="line">      removeTokens();</span><br><span class="line">      <span class="comment">//  这里是路由重置 将路由重置为没有角色权限的路由 就是login</span></span><br><span class="line">      resetRouter();</span><br><span class="line"></span><br><span class="line">      dispatch(<span class="string">&quot;tagsView/delAllViews&quot;</span>, <span class="literal">null</span>, &#123; <span class="attr">root</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line">      resolve();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 清空重置Token的方法</span></span><br><span class="line">  <span class="function"><span class="title">resetToken</span>(<span class="params">&#123; commit &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">      commit(<span class="string">&quot;SET_TOKEN&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">      commit(<span class="string">&quot;SET_ROLES&quot;</span>, []);</span><br><span class="line">      removeToken();</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// dynamically modify permissions</span></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">changeRoles</span>(<span class="params">&#123; commit, dispatch &#125;, role</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> token = role + <span class="string">&quot;-token&quot;</span>;</span><br><span class="line"></span><br><span class="line">    commit(<span class="string">&quot;SET_TOKEN&quot;</span>, token);</span><br><span class="line">    setToken(token);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; roles &#125; = <span class="keyword">await</span> dispatch(<span class="string">&quot;getInfo&quot;</span>);</span><br><span class="line"></span><br><span class="line">    resetRouter();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// generate accessible routes map based on roles</span></span><br><span class="line">    <span class="keyword">const</span> accessRoutes = <span class="keyword">await</span> dispatch(<span class="string">&quot;permission/generateRoutes&quot;</span>, roles, &#123;</span><br><span class="line">      <span class="attr">root</span>: <span class="literal">true</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// dynamically add accessible routes</span></span><br><span class="line">    router.addRoutes(accessRoutes);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// reset visited views and cached views</span></span><br><span class="line">    dispatch(<span class="string">&quot;tagsView/delAllViews&quot;</span>, <span class="literal">null</span>, &#123; <span class="attr">root</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  actions</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>Post title：RenSystem</li>
        <li>Post author：iam_Echo</li>
        <li>Create time：2021-10-27 09:49:02</li>
        <li>
            Post link：https://hurryliwei.github.io/2021/10/27/RenSystem/
        </li>
        <li>
            Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

            </div>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2021/10/27/%E4%BA%BF%E5%88%A9%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">亿利项目总结</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;Comments</i>
    </div>
    

        
            
    <div class="valine-container">
        <script 
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script >
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: 'QUxpNcJdPriNR5IPsdvNBVAS-gzGzoHsz',
                    appKey: 'iau4kX9v3NAQ22FqzYxy9lmA',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: '',
                    lang: 'en'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return '博主';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'iam_Echo';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('false') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">iam_Echo</a>
        </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.3</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%91%9E%E8%83%BD%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="nav-text">瑞能后台管理系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80"><span class="nav-text">基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD"><span class="nav-text">功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E4%BB%A5%E5%8F%8A%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87"><span class="nav-text">系统环境以及项目准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-text">项目目录结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Vue%E7%94%9F%E6%80%81%E5%9C%88"><span class="nav-text">Vue生态圈</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%83%E5%B1%80"><span class="nav-text">布局</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#layout"><span class="nav-text">layout</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#app-main"><span class="nav-text">app-main</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#router-view"><span class="nav-text">router-view</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E5%92%8C%E4%BE%A7%E8%BE%B9%E6%A0%8F"><span class="nav-text">路由和侧边栏</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="nav-text">配置项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1"><span class="nav-text">路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%A7%E8%BE%B9%E6%A0%8F"><span class="nav-text">侧边栏</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E7%BA%A7%E7%9B%AE%E5%BD%95%EF%BC%88%E5%B5%8C%E5%A5%97%E8%B7%AF%E7%94%B1%EF%BC%89"><span class="nav-text">多级目录（嵌套路由）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E9%AA%8C%E8%AF%81"><span class="nav-text">权限验证</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80-1"><span class="nav-text">基础</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E4%BF%AE%E6%94%B9"><span class="nav-text">逻辑修改</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%AB%E6%8D%B7%E5%AF%BC%E8%88%AA%EF%BC%88%E6%A0%87%E7%AD%BE%E6%A0%8F%E5%AF%BC%E8%88%AA%EF%BC%89"><span class="nav-text">快捷导航（标签栏导航）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#visitedViews-amp-amp-cachedViews"><span class="nav-text">visitedViews &amp;&amp; cachedViews</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-text">注意事项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%92%8C%E7%BB%84%E4%BB%B6%E7%9A%84%E7%A7%BB%E9%99%A4"><span class="nav-text">代码和组件的移除</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%BA%A4%E4%BA%92"><span class="nav-text">与服务端交互</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E8%AF%B7%E6%B1%82%E6%B5%81%E7%A8%8B"><span class="nav-text">前端请求流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#request-js"><span class="nav-text">request.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#api%E5%AE%9E%E4%BE%8B"><span class="nav-text">api实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%A4%9A%E4%B8%AAbaseURL"><span class="nav-text">设置多个baseURL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-text">环境变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E7%9B%B8%E5%85%B3"><span class="nav-text">构建相关</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%A6%E7%BB%86%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D"><span class="nav-text">详细功能介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="nav-text">用户管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86"><span class="nav-text">项目管理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Vuex%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="nav-text">Vuex介绍与使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-text">目录结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E6%B3%95%E7%A4%BA%E4%BE%8B"><span class="nav-text">用法示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97%E7%9A%84%E7%AE%A1%E7%90%86%EF%BC%88%E7%A4%BA%E4%BE%8B%EF%BC%89"><span class="nav-text">用户模块的管理（示例）</span></a></li></ol></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>





    
<script src="/js/code-copy.js"></script>





<div class="post-scripts">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>



</body>
</html>
