<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="iam_Echo">
    
    <title>
        
            本地控制器 |
        
        终有沧海替弱水
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"yousite.com","root":"/","language":"en"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.jpg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.jpg","description":"Perseverance can sometimes equal genius in its results"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":false,"preload":false},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.3"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                终有沧海替弱水
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                CATEGORIES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                ABOUT
                            </a>
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">CATEGORIES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">ABOUT</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">本地控制器</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">iam_Echo</span>
                        
                            <span class="author-label">Lv1</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2022-02-14 09:48:30
    </span>
    
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>12.6k Words</span>
        </span>
    
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="本地控制器前端开发文档"><a href="#本地控制器前端开发文档" class="headerlink" title="本地控制器前端开发文档"></a>本地控制器前端开发文档</h1><h2 id="1-通信参数采集功能"><a href="#1-通信参数采集功能" class="headerlink" title="1. 通信参数采集功能"></a>1. 通信参数采集功能</h2><hr>
<p>​        通信采集功能主要是对数据库的几张表进行操作，主要是包括：总线对象模型表、总线对象表、总线对象字段表、从</p>
<p>站对象表、从站对象字段表、从站数据点对象、从站数据点对象字段表进行操作。由固定的这几张表，可以准确的实现从</p>
<p>总线到数据点的采集以及CRUD操作。</p>
<hr>
<h2 id="1-1-功能页面的构建"><a href="#1-1-功能页面的构建" class="headerlink" title="1.1 功能页面的构建"></a>1.1 功能页面的构建</h2><p>​        主要由两部分功能组成，左边是一个树形结构，右边是一个table组件，这个table组件是动态生成表头和表单主体内</p>
<p>内容的；而这个table表单又作为了父元素，里面包含了很多小的组件，比如上传CSV的组件，上传总线驱动的组件等等。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;tree&quot;&gt;</span><br><span class="line">        &lt;el-tree</span><br><span class="line">          :data=&quot;treeData&quot;</span><br><span class="line">          :props=&quot;defaultProps&quot;</span><br><span class="line">          :expand-on-click-node=&quot;false&quot;</span><br><span class="line">          default-expand-all</span><br><span class="line">          @node-click=&quot;handleNodeClick&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;span</span><br><span class="line">            class=&quot;custom-tree-node&quot;</span><br><span class="line">            :class=&quot;data.class&quot;</span><br><span class="line">            slot-scope=&quot;&#123; node, data &#125;&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;span v-if=&quot;node.level === 1&quot;&gt;</span><br><span class="line">              &lt;i class=&quot;iconfont icon-caiji&quot; style=&quot;margin-right: 15px&quot;&gt;&lt;/i</span><br><span class="line">              &gt;&#123;&#123; node.label &#125;&#125;</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">            &lt;span v-else-if=&quot;node.level === 2&quot;&gt;</span><br><span class="line">              &lt;i</span><br><span class="line">                class=&quot;iconfont icon-xiaoxiduilie&quot;</span><br><span class="line">                style=&quot;margin-right: 15px&quot;</span><br><span class="line">              &gt;&lt;/i</span><br><span class="line">              &gt;&#123;&#123; node.label &#125;&#125;</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">            &lt;span v-else&gt;</span><br><span class="line">              &lt;i class=&quot;iconfont icon-liujisuan&quot; style=&quot;margin-right: 15px&quot;&gt;&lt;/i</span><br><span class="line">              &gt;&#123;&#123; node.label &#125;&#125;</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">          &lt;/span&gt;</span><br><span class="line">        &lt;/el-tree&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;dynamicTable&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;header-1&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;title&quot;&gt;&lt;/span&gt;</span><br><span class="line">        &lt;span class=&quot;title-1&quot;&gt;详细配置&lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;tableInfo&quot;&gt;</span><br><span class="line">        &lt;tableInfo</span><br><span class="line">          :tableData=&quot;tableInfoData&quot;</span><br><span class="line">          :columns=&quot;columnsInfo&quot;</span><br><span class="line">          :modalStatus=&quot;modalStatus&quot;</span><br><span class="line">          :pointStatus=&quot;pointStatus&quot;</span><br><span class="line">          :busStatus=&quot;busStatus&quot;</span><br><span class="line">          :salveStatus=&quot;salveStatus&quot;</span><br><span class="line">          :model_id=&quot;modelId&quot;</span><br><span class="line">          :bus_id=&quot;busId&quot;</span><br><span class="line">          @modalManager=&quot;modalManager&quot;</span><br><span class="line">        &gt;&lt;/tableInfo&gt;</span><br><span class="line">        &lt;pagination</span><br><span class="line">          style=&quot;margin-left: 20px&quot;</span><br><span class="line">          v-show=&quot;total &gt; 0&quot;</span><br><span class="line">          :total=&quot;total&quot;</span><br><span class="line">          :page.sync=&quot;listQuery.page&quot;</span><br><span class="line">          :limit.sync=&quot;listQuery.limit&quot;</span><br><span class="line">          @pagination=&quot;getPagination&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>树形结构之所以选择这么做是因为，树形结构需要更换每一个label前面的图标，便于区分每一层级对应的对应的东西；这样使用嵌套的方法，也可以树形结构渲染出来，通过slot插槽来将所有的node渲染出来，这里巧妙的运了本身tree内部会对每个节点分级，所以v-if、v-else-if、v-else来判断node的等级，并将图标渲染出来，iconfont可以自己下载，然后main.js中引入即可全局使用。</p>
<p>接下来就是引入两个组件，一个是自己定义的table表单组件，一个是分页组件，这里为什么不把分页的组件放到动态表单中打包呢？是因为不管放到父级还是放到子组件中，都是一样的，只要可以将方法传递出去即可成功实现分页的功能，况且，每当点击一个树形结构节点就会导致分页的触发，因为每次拉取table的第一页用到的也是分页的功能，所以放到父级和tree一级是最好的办法，每次点击过后将treeData保存在Vuex中，然后每当点击触发分页时，去判断你触发的是modal的管理，还是其他的管理，如果是model的管理就要走model的接口，然后获取当前组件的页数，页码和对应的条数。（注意：这里所有的table用的都是这个组件，所以当触发接口的时候，只是接口变了，但是数据还是操作的当前分页组件的数据，所以数据本身不会出错的。这里就是Vue的组件复用的强大之处，不管你怎么复用每当你点击node之后table改变，你的分页组件就会初始化，然后当你点击分页组件里的数据的时候，就会判断 如果是tree的node，就会再次将handleClick触发，然后继续判断，你点击的是哪个node然后走对应的接口，这时这里的分页数据dataquery已经不是默认值了，这里相当于使用了一个函数的复用，类似于闭包函数的思想，用一个节点触发函数来将两个功能实现。）</p>
<p>下面是动态表单组件的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;table&quot;&gt;</span><br><span class="line">     &lt;el-table</span><br><span class="line">       :data=&quot;tableData&quot;</span><br><span class="line">       style=&quot;width: 100%; border: 1px solid #cccccc&quot;</span><br><span class="line">     &gt;</span><br><span class="line">       &lt;el-table-column</span><br><span class="line">         v-for=&quot;(col, i) in columns&quot;</span><br><span class="line">         :label=&quot;col.label&quot;</span><br><span class="line">         :key=&quot;i&quot;</span><br><span class="line">       &gt;</span><br><span class="line">         &lt;template slot-scope=&quot;&#123; row &#125;&quot;&gt;</span><br><span class="line">           &lt;!-- 选择器 --&gt;</span><br><span class="line">           &lt;el-select</span><br><span class="line">             v-model=&quot;row[col.value]&quot;</span><br><span class="line">             placeholder=&quot;请选择&quot;</span><br><span class="line">             v-if=&quot;row.editing &amp;&amp; attrArr.indexOf(col.value) &gt; -1&quot;</span><br><span class="line">           &gt;</span><br><span class="line">             &lt;el-option</span><br><span class="line">               v-for=&quot;item in selectOptions(col.value, enumRules)&quot;</span><br><span class="line">               :key=&quot;item.value&quot;</span><br><span class="line">               :label=&quot;item.label&quot;</span><br><span class="line">               :value=&quot;item.value&quot;</span><br><span class="line">             &gt;</span><br><span class="line">             &lt;/el-option&gt;</span><br><span class="line">           &lt;/el-select&gt;</span><br><span class="line">           &lt;!-- 输入框 --&gt;</span><br><span class="line">           &lt;el-input</span><br><span class="line">             size=&quot;small&quot;</span><br><span class="line">             v-model=&quot;row[col.value]&quot;</span><br><span class="line">             placeholder=&quot;请输入内容&quot;</span><br><span class="line">             v-else-if=&quot;row.editing &amp;&amp; !attrArr.indexOf(col.value) &gt; -1&quot;</span><br><span class="line">           &gt;&lt;/el-input&gt;</span><br><span class="line">           &lt;!-- 文本显示 --&gt;</span><br><span class="line">           &lt;span v-else&gt;&#123;&#123; row[col.value] &#125;&#125;&lt;/span&gt;</span><br><span class="line">         &lt;/template&gt;</span><br><span class="line">       &lt;/el-table-column&gt;</span><br><span class="line">       &lt;el-table-column label=&quot;操作&quot; align=&quot;center&quot; width=&quot;239&quot;&gt;</span><br><span class="line">         &lt;template slot-scope=&quot;&#123; row, $index &#125;&quot;&gt;</span><br><span class="line">           &lt;el-button</span><br><span class="line">             size=&quot;mini&quot;</span><br><span class="line">             v-if=&quot;!row.editing &amp;&amp; modalStatus&quot;</span><br><span class="line">             @click=&quot;handleDownload($index, row)&quot;</span><br><span class="line">             &gt;下载&lt;/el-button</span><br><span class="line">           &gt;</span><br><span class="line">           &lt;el-button</span><br><span class="line">             size=&quot;mini&quot;</span><br><span class="line">             v-if=&quot;!row.editing &amp;&amp; !modalStatus&quot;</span><br><span class="line">             @click=&quot;handleEdit($index, row)&quot;</span><br><span class="line">             &gt;编辑&lt;/el-button</span><br><span class="line">           &gt;</span><br><span class="line">           &lt;el-button</span><br><span class="line">             size=&quot;mini&quot;</span><br><span class="line">             v-if=&quot;row.editing&quot;</span><br><span class="line">             icon=&quot;el-icon-success&quot;</span><br><span class="line">             @click=&quot;handleSave($index, row)&quot;</span><br><span class="line">             &gt;保存</span><br><span class="line">           &lt;/el-button&gt;</span><br><span class="line">           &lt;el-button</span><br><span class="line">             size=&quot;mini&quot;</span><br><span class="line">             type=&quot;warning&quot;</span><br><span class="line">             v-if=&quot;!row.editing&quot;</span><br><span class="line">             @click=&quot;handleDelete($index, row)&quot;</span><br><span class="line">             &gt;删除&lt;/el-button</span><br><span class="line">           &gt;</span><br><span class="line">           &lt;el-button</span><br><span class="line">             size=&quot;mini&quot;</span><br><span class="line">             v-if=&quot;row.editing&quot;</span><br><span class="line">             @click=&quot;handleCancel($index, row)&quot;</span><br><span class="line">             &gt;取消&lt;/el-button</span><br><span class="line">           &gt;</span><br><span class="line">         &lt;/template&gt;</span><br><span class="line">       &lt;/el-table-column&gt;</span><br><span class="line">     &lt;/el-table&gt;</span><br><span class="line">   &lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>这里的table的每一行都是通过for循环来操作的，由于系统需求是，不同的节点会对应不同的表单，且表单不是固定的属性，为了保证项目的通用性，我们无法确定table的格式，也无法做出所有包含所有可能属性的table组件，只能选择做成动态的table，那么表头和表单内容就一定是来自数据库的，element原本的组件设定已经被打破了。其次，我们的表单要求可以动态的进行CRUD，因为我们无法确定属性的值，所以使用form表单去提交验证的方法也被pass掉了；迫不得已，只能做了行内增加和行内修改，行内提交接口。（这里涉及到一个知识点，如果使用table的话，可以用插槽的功能将table的index和row拿到，这里的index是一定的，且row也是对应的数据的一个对象。可以唯一确定一个对象，比起来用form自己打包数据会方便很多，且减少了对table表单数据体数组的操作，与其操作一个”对象数组”，是不是更倾向于操作一个对象呢？）具体的代码内容会放到后面，现在先看页面的实现。</p>
<p>这里使用到了很多细节的技巧，首先，我们必须要拿到表头，和表头对应的key值，不然无法渲染表头，我曾经尝试只用tableData来做数据处理然后进行v-for循环，但是结果是，性能很差且表头无法显示中文；那么我们就需要跟后端说，给我们传递一个headers对象数组，每一个对象代表一列，也就是一个表头，然后label代表中文，value代表其prop，这样我们就可以保证tableData中的每一项都可以与之对应。用：label来显示中文，然后操作每一行的话，又存在很多情况，我们就要保证每一行是一个模板，这一行用”slot-scope={row}”来抓取本行的数据，这样tableData就被index和row给分成了多行多列的表单；接下来是数据的绑定，前面用到了label，下面用到value，这里row是一个对象对吧，我们需要row.XXX才可以拿到对应要显示的值，也就是绑定的值。但是这里我们只有value，那么就要col.value这样拿到了header中表头对应的key值，然后我们就不可以使用”.”来获取对象的值了，因为会被报错，不可以连点哦在DOM层的渲染中；这里我们使用Object[xxx]的方法，拿到对应的值，也就是需要双向绑定的值，至此双向绑定也解决完毕。</p>
<p>最后是三种状态的互换和改变，因为这里用了行内修改，无法保证校验数据的准确性，那么我们就要尽可能减少用户的输入，使用下拉框来限制用户的选择，减少后端校验的时间成本，也提高用户的体验感。所以这里存在了三种状态，一种是展示状态（text），一种是修改状态（input），还有一种是选择状态（select下拉框）。这里，用到了v-if、v-else-if、以及v-else来处理不同的三种以及三种以上的情况。有了这个还不够，我们还缺少对应的条件，一开始我的想法是只需要判断当前的列是不是修改状态，然后判断当前这一列是不是要修改的列，后来无论怎么尝试，这个下拉框总是显示有BUG存在，也就是说当存在多个下拉框时 这种判断方式会导致渲染dom的异常，也就是所谓的DOM冲突，虚拟DOM树判定走完我们的条件之后并没有发生什么改变，所以该存在东西还是存在，不该存在的也出现了。且，下拉框的数据也出现了问题。</p>
<p>走到这里的时候，我们就要意识到一个问题，如果说，我们每一列都用key来判断是不是要渲染下拉框，那么如果20列都是需要渲染的呢？我们怎么办？挨个写判断方法么？显然不现实，只能用数组的方法，将所有需要下拉框选择的属性放入数组中，然后使用indexof或者ES6中的include()方法都可以，如果当前列的key值存在于这个数组中，那么就渲染为下拉框。然后，通过这个方法我收到了启发，那么既然下拉框都是内置函数操作后渲染出来的，那么就说明，当内置函数判断完毕之后，下拉框变成了单独的个体，在Vue本身的内部被赋予了特殊的标记，那么对应的值也一定可以改变，这时我写了一个return函数，判断这个当前lie的key值，然后return一个选项数组给option即可，后经过测试没有任何问题。这个方法，可以扩展为懒加载，当你点击对应的下拉框，将对应的key值传递给后端，后端返回给你一个选项数组，你return给下拉组件让组件渲染也没问题，或者你可以在页面初始化表单的时候，将这所有key对应的选项值直接存入全局内存中，然后写一个函数  selectOptions(prop, enumRules) 这里第一个参数是key，第二个参数是全部key对应的对象。然后利用一下enumRules.hasOwnProperty（prop）,或者之前提到的Object[prop]都可以。然后再return出去Object[prop] 就好了。这都是内置函数使用的小技巧。这里可能很多人不理解，简单两个内置函数为什么要专门写一个函数来操作，这里就是因为一旦你的组件是由函数return出去的，它就一定会触发视图的渲染，因为组件在这个页面不是唯一的，但是函数是唯一的，函数传入的值和return出的值不同，一定可以让组件发生渲染且不会重复，这也是Vue的核心思想：当组件复用的时候，如何保证组件的数据不重复且高效的复用。</p>
<hr>
<h2 id="1-2-具体方法的实现"><a href="#1-2-具体方法的实现" class="headerlink" title="1.2 具体方法的实现"></a>1.2 具体方法的实现</h2><p>先来看父级Vue中的方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> tableInfo <span class="keyword">from</span> <span class="string">&#x27;@/views/components/dynamicTable.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  getBusModel,</span><br><span class="line">  getTreeInfo,</span><br><span class="line">  getBusById,</span><br><span class="line">  getSlaveByBusId,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/communication&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Pagination <span class="keyword">from</span> <span class="string">&#x27;@/components/Pagination&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    tableInfo,</span><br><span class="line">    Pagination,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// 分页的内容</span></span><br><span class="line">      <span class="attr">total</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">listQuery</span>: &#123;</span><br><span class="line">        <span class="attr">page</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">limit</span>: <span class="number">10</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 树形结构数据</span></span><br><span class="line">      <span class="attr">treeData</span>: [],</span><br><span class="line">      <span class="attr">defaultProps</span>: &#123;</span><br><span class="line">        <span class="attr">children</span>: <span class="string">&#x27;children&#x27;</span>,</span><br><span class="line">        <span class="attr">label</span>: <span class="string">&#x27;label&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 表头和表内容</span></span><br><span class="line">      <span class="attr">columnsInfo</span>: [],</span><br><span class="line">      <span class="attr">tableInfoData</span>: [],</span><br><span class="line">      <span class="comment">//  全局存放拿到的tree对象</span></span><br><span class="line">      <span class="attr">selectTreeData</span>: <span class="literal">undefined</span>,</span><br><span class="line">      <span class="comment">//  是否进行模型管理</span></span><br><span class="line">      <span class="attr">modalStatus</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="comment">//  是否对数据点进行管理</span></span><br><span class="line">      <span class="attr">pointStatus</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="comment">//   是否对总线对象进行管理</span></span><br><span class="line">      <span class="attr">busStatus</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="comment">//   是否对从站对象进管理</span></span><br><span class="line">      <span class="attr">salveStatus</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">modelId</span>: <span class="literal">undefined</span>,</span><br><span class="line">      <span class="attr">busId</span>: <span class="literal">undefined</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 获取树形结构的数据</span></span><br><span class="line">    <span class="built_in">this</span>.handleTreeData()</span><br><span class="line">    <span class="comment">// 获取模型管理的数据 保证当前页面初始化后就是对模型的管理而不是对树形结构中的管理</span></span><br><span class="line">    <span class="built_in">this</span>.modalManager()</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 初始化页面时候拿到树型结构的数据</span></span><br><span class="line">    <span class="function"><span class="title">handleTreeData</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      getTreeInfo().then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res.data)</span><br><span class="line">        <span class="built_in">this</span>.treeData = res.data</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//  模型的管理</span></span><br><span class="line">    <span class="function"><span class="title">modalManager</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="comment">// 将全局对象进行赋值 后面再树形结构的调用以及分页的调用中都会用到这个状态</span></span><br><span class="line">      <span class="built_in">this</span>.modalStatus = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">let</span> dataQuery = &#123;</span><br><span class="line">        <span class="attr">pageNum</span>: <span class="built_in">this</span>.listQuery.page,</span><br><span class="line">        <span class="attr">pageSize</span>: <span class="built_in">this</span>.listQuery.limit,</span><br><span class="line">      &#125;</span><br><span class="line">      getBusModel(dataQuery).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.total = res.data.total</span><br><span class="line">        <span class="built_in">this</span>.tableInfoData = res.data.records</span><br><span class="line">        <span class="built_in">this</span>.columnsInfo = res.data.headers</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//  点击树形接口获取对应的站数据 进行table赋值</span></span><br><span class="line">    <span class="function"><span class="title">handleNodeClick</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// 分页的时候用</span></span><br><span class="line">      <span class="built_in">this</span>.selectTreeData = data</span><br><span class="line">      <span class="comment">// 这里使用 全局Vuex存放Treedata数据 后面组件中会大量用到这个东西 </span></span><br><span class="line">      <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;tree/setCurrentTreeSelect&#x27;</span>, data)</span><br><span class="line">      <span class="comment">// 确定点击的是树形结构而不是模型管理  也就是将模型管理的状态初始化</span></span><br><span class="line">      <span class="built_in">this</span>.modalStatus = <span class="literal">false</span></span><br><span class="line">      <span class="comment">// 从站对象 用来管理点</span></span><br><span class="line">      <span class="keyword">if</span> (data.typeName == <span class="string">&#x27;salve&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// 数据初始化 这里只需要保证 对于点的管理是开启的即可</span></span><br><span class="line">        <span class="comment">// 如果看过上文的页面构造，应该可以看出来，这里决定了table上面的按钮的出现以及消失</span></span><br><span class="line">        <span class="comment">// 以及table内部的按钮 比如模型管理并没有修改 而是下载 都是依靠这三个变量 以及 table的行内变量来 唯一确定状态的</span></span><br><span class="line">        <span class="built_in">this</span>.salveStatus = <span class="literal">false</span></span><br><span class="line">        <span class="built_in">this</span>.busStatus = <span class="literal">false</span></span><br><span class="line">        <span class="built_in">this</span>.pointStatus = <span class="literal">true</span></span><br><span class="line">	   </span><br><span class="line">        <span class="comment">// 用来 让控制台判断 是否进入了这个函数</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;我是从站对象,用来管理所有的点--id是：  &#x27;</span> + data.id)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;=========================================&#x27;</span>)</span><br><span class="line">          </span><br><span class="line">        <span class="keyword">let</span> dataQuery = &#123;</span><br><span class="line">          <span class="attr">pageNum</span>: <span class="built_in">this</span>.listQuery.page,</span><br><span class="line">          <span class="attr">pageSize</span>: <span class="built_in">this</span>.listQuery.limit,</span><br><span class="line">          <span class="attr">parentId</span>: data.parentId + <span class="string">&#x27;,&#x27;</span> + data.id,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 拆解 三层id 并且赋值 方便拿到点的数据</span></span><br><span class="line">        <span class="comment">// 这里之所以拆开 是因为 接口调用的时候 这三个属性也是分开的 不可以像获取一样 拼串</span></span><br><span class="line">        <span class="keyword">let</span> parentArr = data.parentId.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">        <span class="built_in">this</span>.modelId = parentArr[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">this</span>.busId = parentArr[<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">this</span>.slaveId = data.id</span><br><span class="line">        <span class="comment">// 回调函数的调用 赋值表头 标题 选项框</span></span><br><span class="line">        getTagObjById(dataQuery).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.total = res.data.total</span><br><span class="line">          <span class="built_in">this</span>.columnsInfo = res.data.headers</span><br><span class="line">          <span class="built_in">console</span>.log(res.data)</span><br><span class="line">          <span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.tableInfoData = res.data.records</span><br><span class="line">            <span class="built_in">this</span>.attrArr = res.data.enumAttrArr</span><br><span class="line">            <span class="built_in">this</span>.attrRule = res.data.enumRule</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//  总线对象 用来管理从站的</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (data.typeName == <span class="string">&#x27;bus&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// 数据初始化 这里其实应该写成vueX 但是只有两个变量 完全没必要写成Vuex 用到的地方太少了</span></span><br><span class="line">        <span class="comment">// 只有一个table组件中会用到这个属性，之后所有的功能都不会和这个通信采集有很多交集</span></span><br><span class="line">        <span class="comment">// 所以这里 就简单的使用父子组件传参来做这个功能 就不写Vuex了 虽然性能消耗差不多 </span></span><br><span class="line">        <span class="comment">// 但是直接写也不是太乱 所以就不做优化了 如果直接写很乱 且全局需求很大的情况下 就要考虑提取出来写到VueX了</span></span><br><span class="line">        <span class="built_in">this</span>.pointStatus = <span class="literal">false</span></span><br><span class="line">        <span class="built_in">this</span>.busStatus = <span class="literal">false</span></span><br><span class="line">        <span class="built_in">this</span>.salveStatus = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;我是总线对象,用来管理从站--id是：  &#x27;</span> + data.id)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;=====================================================&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// params的值 这里接口需要传递 model_id 也就是父级ID 和 本身的id</span></span><br><span class="line">        <span class="comment">// 基本上每一个接口 当点击了节点，这个节点只要包含了父级就一定要传父级节点的ID</span></span><br><span class="line">        <span class="comment">// 总线也是一样的 它虽然没有父级 但是他有对应的驱动ID 可以保证判断到 这个bus是属于那个驱动 也就是类型的</span></span><br><span class="line">        <span class="keyword">let</span> dataQuery = &#123;</span><br><span class="line">          <span class="attr">pageNum</span>: <span class="built_in">this</span>.listQuery.page,</span><br><span class="line">          <span class="attr">pageSize</span>: <span class="built_in">this</span>.listQuery.limit,</span><br><span class="line">          <span class="attr">parentId</span>: data.parentId + <span class="string">&#x27;,&#x27;</span> + data.id,</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 这里是 当你点击总线对象时 需要给table组件传递两个值</span></span><br><span class="line">        <span class="comment">// 这两个值 会在CRUD的接口中使用到 和上文一样 你查询信息需要id和父级id 那么当它进行删除和新增 更新时也是一样的</span></span><br><span class="line">        <span class="comment">// 所以需要通过prop传递过去</span></span><br><span class="line">        <span class="comment">// 这里写两个值是因为 树形结构本身是展开的</span></span><br><span class="line">        <span class="comment">// 如果他直接点击总线对象去管理从站的话 会导致总线对象的父级 也就是model_id为undefined 所以导致操作失败</span></span><br><span class="line">        <span class="comment">// 所以每一个节点都需要传递至少两个值 来进行CURD操作</span></span><br><span class="line">        <span class="built_in">this</span>.busId = data.id</span><br><span class="line">        <span class="built_in">this</span>.modelId = data.parentId</span><br><span class="line"></span><br><span class="line">        getSlaveByBusId(dataQuery).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.total = res.data.total</span><br><span class="line">          <span class="built_in">this</span>.columnsInfo = res.data.headers</span><br><span class="line">          <span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.tableInfoData = res.data.records</span><br><span class="line">            <span class="comment">// 需要拿到 enumattr</span></span><br><span class="line">            <span class="comment">// 需要拿到对应的 enumrule</span></span><br><span class="line">            <span class="comment">// 这里的两个值  也是需要全局变量保存 然后父子组件传参来 保证子组件可以收到</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; </span><br><span class="line">        <span class="comment">// 模型对象没父级 用来管理所有的总线 它的父级就是对应的类型 是TPC RUT 还是104 </span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 状态初始化</span></span><br><span class="line">        <span class="built_in">this</span>.pointStatus = <span class="literal">false</span></span><br><span class="line">        <span class="built_in">this</span>.salveStatus = <span class="literal">false</span></span><br><span class="line">        <span class="built_in">this</span>.busStatus = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;我是模型对象没父级,用来管理对应的总线&#x27;</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;=====================================================&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 这里是被点击的模型下 对应的所有总线，那么就需要传递 busModuleId也就是点击的节点本身的id</span></span><br><span class="line">        <span class="comment">// 这里只是换了个key值 变成了 busModuleId，其实要传的值就是本身的id而已，因为这个节点就代表一个module了</span></span><br><span class="line">        <span class="keyword">let</span> dataQuery = &#123;</span><br><span class="line">          <span class="attr">pageNum</span>: <span class="built_in">this</span>.listQuery.page,</span><br><span class="line">          <span class="attr">pageSize</span>: <span class="built_in">this</span>.listQuery.limit,</span><br><span class="line">          <span class="attr">busModuleId</span>: data.id,</span><br><span class="line">        &#125;</span><br><span class="line">	    </span><br><span class="line">        <span class="comment">// 这里在table CRUD操作BUS总线的时候，只需要传递一个modelid即可  不需要父级</span></span><br><span class="line">        <span class="comment">// 这里有个知识点，就是this.$nextTick(),之前没有进行前后端联调的时候，我使用的方法是 直接赋值</span></span><br><span class="line">        <span class="comment">// 并不会存在任何bug但是当我是调用后端的数据再赋值的时候发现，最后一列总是渲染不出来，存在了dom渲染bug，那么这个时候，</span></span><br><span class="line">        <span class="comment">// 你可以选择写一个定时器 先传递表头过去 然后 在传递表单内容过去 间隔500毫秒即可，但是这个方法存在一个异步嵌套异步执行的方法 </span></span><br><span class="line">        <span class="comment">// 性能问题有待考究 所以我选择了 后端给我的提示 它说用nextTick 一般只有echart的渲染我才会使用这个办法，这个可以保证当数据刷新后，立马执行</span></span><br><span class="line">        <span class="comment">// 保证了echart动态图的渲染 及时性 且不会数据冲突渲染，这里用这个同样合适，先渲染一次表头 然后组件刷新，这时nextTick指针触发</span></span><br><span class="line">        <span class="comment">// 立马渲染了表单内容 我们肉眼无法分辨他的区别 但是 事实上是解决了这个dom渲染问题的 以后在开发中也要注意此类问题</span></span><br><span class="line">        <span class="comment">// 每一个函数的存在都是有它存在的意义的 更何况这时Vue内置的函数 说明一定有适合它来解决的问题的</span></span><br><span class="line">        <span class="built_in">this</span>.modelId = data.id</span><br><span class="line">        getBusById(dataQuery).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.total = res.data.total</span><br><span class="line">          <span class="built_in">this</span>.columnsInfo = res.data.headers</span><br><span class="line">          <span class="built_in">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.tableInfoData = res.data.records</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 这里是分页的方法，跟前面说的一样 这里只有modal被管理的情况和tree中节点对应table被分页的情况</span></span><br><span class="line">    <span class="comment">// 只需要判断是modal触发还是tree触发 就可以再次调用对应的查询方法就可以拿到值 并且渲染页面</span></span><br><span class="line">    <span class="comment">// 这里如果写成两个接口就很麻烦， 所以 后端在这里要 变成默认不传 页码和条数也要有默认值</span></span><br><span class="line">    <span class="comment">// 但是如果传递了 也可以变成分页查询的方法</span></span><br><span class="line">    <span class="comment">// 这样做的好处是，防止服务器爆炸，因为这个涉及到工业数据，如果你是主站、从站都没事，</span></span><br><span class="line">    <span class="comment">// 但是万一是数据点呢？ 几百个点的数据一次请求过来，不仅是服务器接受不了，就连前端页面也很少能承载这么多数据吧</span></span><br><span class="line">    <span class="comment">// 所以后端，这里要做处理 </span></span><br><span class="line">    <span class="function"><span class="title">getPagination</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;触发了分页方法&#x27;</span>)</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.modalStatus) &#123;</span><br><span class="line">        <span class="built_in">this</span>.modalManager()</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.handleNodeClick(<span class="built_in">this</span>.selectTreeData)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 这里是对proviede() 和 inject()方法的使用,也就是将某个方法 全部的抛出到Vue全局中，然后Vue中的其他组件可以注入这个方法</span></span><br><span class="line">  <span class="comment">// 并且调用这个方法</span></span><br><span class="line">  <span class="comment">// 这个方法对用于三层嵌套的父子组件中常见，当子组件还引用了子组件，而恰好子组件又需要这个父级最外层的方法</span></span><br><span class="line">  <span class="comment">// 如果你使用prop传递也可以，但是传递两层 可能会导致数据不刷新哦，这时候 你就需要$set来解决了吧，但是恰好本项目很多地方的数据 </span></span><br><span class="line">  <span class="comment">// 是来自于接口 不可以使用这个方法</span></span><br><span class="line">  <span class="comment">// 所以我选择了 provide()</span></span><br><span class="line">  <span class="function"><span class="title">provide</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">modalManager</span>: <span class="built_in">this</span>.modalManager,</span><br><span class="line">      <span class="attr">handleNodeClick</span>: <span class="built_in">this</span>.handleNodeClick,</span><br><span class="line">      <span class="attr">handleTreeData</span>: <span class="built_in">this</span>.handleTreeData,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>核心的代码思想全部写入了代码的注释里面，方便快速的读懂代码以及对应的意思。</p>
<p>接下来看，动态表单组件的Vue的方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">import UploadSoComponent from &#x27;@/views/upload/index.vue&#x27;</span><br><span class="line">import UploadCsvComponent from &#x27;@/views/upload/uploadCsv.vue&#x27;</span><br><span class="line">import &#123; mapState &#125; from &#x27;vuex&#x27;</span><br><span class="line">import &#123;</span><br><span class="line">  deleteBusModel,</span><br><span class="line">  downloadBus,</span><br><span class="line">  addBusObj,</span><br><span class="line">  deleteBusObj,</span><br><span class="line">  updateBusObj,</span><br><span class="line">  addSlaveObj,</span><br><span class="line">  deleteSlaveObj,</span><br><span class="line">  updateSlaveObj,</span><br><span class="line">&#125; from &#x27;@/api/communication&#x27;</span><br><span class="line">import &#123; string &#125; from &#x27;jszip/lib/support&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123; UploadCsvComponent, UploadSoComponent &#125;,</span><br><span class="line">  // prop父子组件传递的值，这里默认就是全局变量 调用时需要用到this</span><br><span class="line">  props: &#123;</span><br><span class="line">    tableData: &#123;</span><br><span class="line">      type: Array,</span><br><span class="line">      require: true,</span><br><span class="line">    &#125;,</span><br><span class="line">    columns: &#123;</span><br><span class="line">      type: Array,</span><br><span class="line">      require: true,</span><br><span class="line">    &#125;,</span><br><span class="line">    modalStatus: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">    &#125;,</span><br><span class="line">    pointStatus: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">    &#125;,</span><br><span class="line">    busStatus: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">    &#125;,</span><br><span class="line">    salveStatus: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">    &#125;,</span><br><span class="line">    model_id: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">    &#125;,</span><br><span class="line">    bus_id: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">    &#125;,slave_Id: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">    &#125;,</span><br><span class="line">    enumAttrArr: &#123;</span><br><span class="line">      type: Array,</span><br><span class="line">      require: true,</span><br><span class="line">    &#125;,</span><br><span class="line">    enumRule: &#123;</span><br><span class="line">      type: Object,</span><br><span class="line">      require: true,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      dialogExcelVisible: false,</span><br><span class="line">      dialogSoVisible: false,</span><br><span class="line">      // 导出excel模板的数据</span><br><span class="line">      ExcelData: [],</span><br><span class="line">      // 模板导出时使用的header的数组</span><br><span class="line">      excelTableHeader: [],</span><br><span class="line">      // 下拉框属性数组,存放于此的属性都需要渲染为下拉框</span><br><span class="line">      attrArr: [&#x27;name&#x27;, &#x27;address&#x27;, &#x27;date&#x27;],</span><br><span class="line">      // 下拉框的数组 通过不同的key来返回对应的选项值</span><br><span class="line">      enumRules: &#123;</span><br><span class="line">        name: [],</span><br><span class="line">        address: [],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 方法注入功能 将某个Vue中provide()出的功能进行引用</span><br><span class="line">  inject: [&#x27;handleNodeClick&#x27;, &#x27;handleTreeData&#x27;],</span><br><span class="line">  // 计算属性 这里主要是用来监听VueX中的值，当然也可以使用这个方法来监听prop中的值</span><br><span class="line">  // 但是正宗的监听方法是使用 watch 因为watch有深度监听 虽然计算属性也可以 但是</span><br><span class="line">  // watch可以深度监听数组的变化 这个具体对于数组的变化是否触发dom渲染 可以自行百度查看</span><br><span class="line">  // 不是所有的方法都会触发dom的渲染 也不是都会被监听到的 </span><br><span class="line">  // 所以使用watch是/deep/是正宗的深度监听数组和对象变化的方法</span><br><span class="line">  computed: &#123;</span><br><span class="line">    ...mapState(&#123;</span><br><span class="line">      selectTreeData: (state) =&gt; state.tree.selectTreeData,</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;,</span><br><span class="line">  // watch监听 某个对象和数组 这里为了防止 数据分不清 你可以使用console来输出一下 新的值</span><br><span class="line">  // 如果你对于oldValue也有需求 或者有方法 需要对比他们的差距 或者暂存oldValue 也可以在这里操作</span><br><span class="line">  // watch是监听变化前和变化后的数组反应</span><br><span class="line">  // 这里监听多用于存在echarts的时候，如果没有echarts的话 也可以解决其他的动态渲染DOM层的问题</span><br><span class="line">  watch: &#123;</span><br><span class="line">    tableData(newVal) &#123;</span><br><span class="line">      this.tableData = newVal</span><br><span class="line">    &#125;,</span><br><span class="line">    columns(newVal) &#123;</span><br><span class="line">      this.columns = newVal</span><br><span class="line">      console.log(newVal)</span><br><span class="line">    &#125;,</span><br><span class="line">    modalStatus(newVal) &#123;</span><br><span class="line">      this.modalStatus = newVal</span><br><span class="line">    &#125;,</span><br><span class="line">    pointStatus(newVal) &#123;</span><br><span class="line">      this.pointStatus = newVal</span><br><span class="line">    &#125;,</span><br><span class="line">    busStatus(newVal) &#123;</span><br><span class="line">      this.busStatus = newVal</span><br><span class="line">    &#125;,</span><br><span class="line">    salveStatus(newVal) &#123;</span><br><span class="line">      this.salveStatus = newVal</span><br><span class="line">    &#125;,</span><br><span class="line">    model_id(newVal) &#123;</span><br><span class="line">      this.model_id = newVal</span><br><span class="line">      console.log(&#x27;modelId&#x27;)</span><br><span class="line">      console.log(this.model_id)</span><br><span class="line">    &#125;,</span><br><span class="line">    bus_id(newVal) &#123;</span><br><span class="line">      this.bus_id = newVal</span><br><span class="line">      console.log(&#x27;bus_id&#x27;)</span><br><span class="line">      console.log(this.bus_id)</span><br><span class="line">    &#125;,</span><br><span class="line">    slave_Id(newVal) &#123;</span><br><span class="line">      this.slave_Id = newVal</span><br><span class="line">      console.log(&#x27;slave_Id&#x27;)</span><br><span class="line">      console.log(this.slave_Id)</span><br><span class="line">    &#125;,</span><br><span class="line">    enumAttrArr(newVal) &#123;</span><br><span class="line">      this.enumAttrArr = newVal</span><br><span class="line">    &#125;,</span><br><span class="line">    enumRule(newVal) &#123;</span><br><span class="line">      this.enumRule = newVal</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 获取每一个key对应的选项</span><br><span class="line">    // 巧妙的使用es5和ES6的方法来保证组件的复用但是数据的唯一性</span><br><span class="line">    // 具体的原理和解释 在上面的内容中有提到过  这里只是给出了我习惯的一种解决办法而已</span><br><span class="line">    selectOptions(prop, enumRules) &#123;</span><br><span class="line">      if (enumRules.hasOwnProperty(prop)) &#123;</span><br><span class="line">        return enumRules[prop]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 新增一行配置</span><br><span class="line">    // 这里是使用push方法，来push一个空数组进去，push方法会导致dom层的渲染，且监听是可以监听到push方法的</span><br><span class="line">    // 而element的表单是可以动态渲染的 所以这里这个方法再好不过</span><br><span class="line">    // 因为这里还存在一个新增行的保存提交接口 和 已有数据的保存提交问题</span><br><span class="line">    // 所以这里使用$set方法，给新增的这一行进行赋值一个状态，在下面的提交方法中 会用这个状态来判断是新增还是修改内容</span><br><span class="line">    handleAdd() &#123;</span><br><span class="line">      this.tableData.push(&#123;&#125;)</span><br><span class="line">      this.$set(this.tableData[this.tableData.length - 1], &#x27;adding&#x27;, true)</span><br><span class="line">      console.log(this.tableData)</span><br><span class="line">      // 下面被注释的内容 主要是写了一段函数来确定每次只可以新增一行 当时我考虑到 如果一个人要一次性添加很多项怎么办</span><br><span class="line">      // 为了怕提交逻辑出现问题 因为存在一个状态的改变而状态的改变很有可能是错的 所以我想到了只让每次操作一行</span><br><span class="line">      // 但后面优化了提交逻辑 我觉得 这里可有可无 不写也不会影响全局使用，就算是它一次性 增加了10个对象 它也的每次只提交一个对象 </span><br><span class="line">      // 所以我就注释掉了这里</span><br><span class="line">      // 还是解释一下 这里的逻辑 首先判断 本身是否有数据 如果点击到了这个表单，这个表单本身下面没有数据，也就是数据库没有对应的数据</span><br><span class="line">      // 那么一定是可以push新的对象进去，且赋值这一行是新增的，如果保存的话 一定走的是新增接口</span><br><span class="line">      // 如果当前的tableData不是空的，也就是本身就有数据那么就要判断，这个表单的最后个是不是包含adding状态的 如果是后端返回的一定不包含，</span><br><span class="line">      // 那么此时就可以给它 push新的空对象进去 且 赋值为adding状态</span><br><span class="line">      // 如果 不是这样的 说明它已经增加了一个新对象 那么这个时候 就要return false让他不可以再添加新的对象进去，</span><br><span class="line">      // 这样就保证了每次只能新增一行，且调用的方法不会出现错误 </span><br><span class="line">      // 可能有人觉得 第一行if不用写也可以 ，但是 当你测试就会发现，这里是处理异常情况，如果本身的长度为0的话，那么length-1会立马报错</span><br><span class="line">      // 所以if解决特殊情况 是一定要写的 很多算法题 都需要考虑到 为0这个情况 这里只是处理length为0的一种特殊情况的方法 记得处理完要return;</span><br><span class="line">      // 不知道return;含义的可以 自行百度</span><br><span class="line">        </span><br><span class="line">      //   if (this.tableData.length == 0) &#123;</span><br><span class="line">      //     this.tableData.push(&#123;&#125;)</span><br><span class="line">      //     this.$set(this.tableData[this.tableData.length - 1], &#x27;adding&#x27;, true)</span><br><span class="line">      //     return;</span><br><span class="line">      //   &#125;</span><br><span class="line">      //   if (this.tableData[this.tableData.length - 1].hasOwnProperty(&#x27;adding&#x27;)) &#123;</span><br><span class="line">      //     console.log(&#x27;只能一条一条的新增&#x27;)</span><br><span class="line">      //     return false</span><br><span class="line">      //   &#125; else &#123;</span><br><span class="line">      //     this.tableData.push(&#123;&#125;)</span><br><span class="line">      //     this.$set(this.tableData[this.tableData.length - 1], &#x27;adding&#x27;, true)</span><br><span class="line">      //   &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">      </span><br><span class="line">    // 编辑当前行</span><br><span class="line">    // 这里是使用$set来给当前行 进行赋值editing操作，方便table表单中按钮的渲染 以及下面提交接口的使用</span><br><span class="line">    // 这里至关重要，如果不使用这个方法，那么table就无法监听到变化 那么数据以及按钮的v-if就不会生效的</span><br><span class="line">    handleEdit(index, row) &#123;</span><br><span class="line">      this.$set(this.tableData[index], &#x27;editing&#x27;, true)</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    // 保存当前行 也就是调用接口进行数据的处理</span><br><span class="line">    // 这里需要分情况来看 首先必须要的参数就是index和row</span><br><span class="line">    handleSave(index, row) &#123;</span><br><span class="line">      //  新增模型数据 </span><br><span class="line">      //  当busStatus为真 且 当前行是新增的时候  就要走新增数据的接口</span><br><span class="line">      //  默认点击后要将editing设置为false 因为我这里是测试 所以 我没有放到 接口的回调中</span><br><span class="line">      //  我默认将所有的新增的editing设置放到了回调函数前面，而在修改接口中 默认将所有的editing赋值放到了回调函数成功的里面</span><br><span class="line">      //  其实这里应该是要放到接口的回调中 然后防止 接口返回失败 那么就省去了 再次点击编辑按钮的步骤</span><br><span class="line">      row.editing = false</span><br><span class="line">      if (this.busStatus &amp;&amp; row.adding) &#123;</span><br><span class="line">        console.log(&#x27;新增模型数据&#x27;)</span><br><span class="line">        //  因为我们的后端不可以接受多余的参数 所以这里的editing和adding都要在判断后进行删除</span><br><span class="line">        //  如果成功的话 需要调用hanleNodeClick函数，就是触发节点的函数 刷新一下表单的数据 这个方法很好用</span><br><span class="line">        //  因为如果你新增成功 不刷新表单 用户并不会自己手动刷新的 她不懂这个机制 所以我们需要考虑到这一点 </span><br><span class="line">        //  我用的是inject的方法 可以直接用  当然使用父子组件传递函数的方法也可以 但是这样写法就稍微麻烦一点 自行选择自己喜欢的方法</span><br><span class="line">        //  我选择的这个方法 自由度较高 放到哪里都可以使用 </span><br><span class="line">        //  这里因为接口使用到了 model_id所以，我这里又设置了新的属性为model_id 不然接口会报错</span><br><span class="line">        this.$delete(this.tableData[index], &#x27;editing&#x27;)</span><br><span class="line">        this.$delete(this.tableData[index], &#x27;adding&#x27;)</span><br><span class="line">        this.$set(row, &#x27;model_id&#x27;, this.model_id)</span><br><span class="line">        //  这里存在一点小插曲，就是我们后端以前是JAVA的时候，确实可以json对象传递body过去，但是现在改成了C语言写后端之后</span><br><span class="line">        //  我用json对象body传参就是会导致 跨域问题，前提是我们俩都处理了 前后端跨域的问题，但是还是有问题 我也无能为力。</span><br><span class="line">        //  所以当我看到删除数据 也是data传参 且后端要求是json字符串时 没有出现跨域问题 我就知道 所有的接口都需要json字符串</span><br><span class="line">        //  也就顺利的解决了前后端的问题  这里每个人都要摸索啊 这里百度不到 需要在自己去探索  如果不是很熟悉后端的话 可能想不到这个问题</span><br><span class="line">        let obj = JSON.stringify(row)</span><br><span class="line">        //  这里就是正常的回调函数的使用 没有什么可以说的 </span><br><span class="line">        addBusObj(obj).then((res) =&gt; &#123;</span><br><span class="line">          if (res.code == 1) &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &#x27;新增成功&#x27;,</span><br><span class="line">              type: &#x27;success&#x27;,</span><br><span class="line">            &#125;)</span><br><span class="line">            this.handleNodeClick(this.selectTreeData)</span><br><span class="line">            this.handleTreeData()</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &#x27;新增失败,请重试&#x27;,</span><br><span class="line">              type: &#x27;error&#x27;,</span><br><span class="line">            &#125;)</span><br><span class="line">            this.handleNodeClick(this.selectTreeData)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      //   修改模型数据</span><br><span class="line">      //   这里一样的 也是使用 状态判断 是不是busStatus为true而新增为否，如果新增为否 那么就是本身就存在的数据</span><br><span class="line">      //   那么这里调用就是来更新数据</span><br><span class="line">      else if (this.busStatus &amp;&amp; !row.adding) &#123;</span><br><span class="line">        console.log(&#x27;修改模型数据&#x27;)</span><br><span class="line">        // 一样删除没有用的数据  为了防止意外 我这里还是删除了adding一次</span><br><span class="line">        // 其实不删除也没事 因为本身没有这个属性 但是删除也不会报错 </span><br><span class="line">        // 最后就是update更新接口 也需要这个model_id 也要设置进去 </span><br><span class="line">        this.$delete(this.tableData[index], &#x27;editing&#x27;)</span><br><span class="line">        this.$delete(this.tableData[index], &#x27;adding&#x27;)</span><br><span class="line">        this.$set(row, &#x27;model_id&#x27;, this.model_id)</span><br><span class="line">        // 照常去解决跨域问题 json字符串  其实有点类似于 jsonp的传参方式 来解决跨域问题</span><br><span class="line">        // 有可能确实是存在跨域 但是变相使用了json字符串 就相当于jsonP的传参来解决了跨域</span><br><span class="line">        // 至于为什么 还是要以后再考究这个问题 </span><br><span class="line">        let obj = JSON.stringify(row)</span><br><span class="line">        updateBusObj(obj).then((res) =&gt; &#123;</span><br><span class="line">          if (res.code == 1) &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &#x27;修改成功&#x27;,</span><br><span class="line">              type: &#x27;success&#x27;,</span><br><span class="line">            &#125;)</span><br><span class="line">            row.editing = false</span><br><span class="line">            this.handleNodeClick(this.selectTreeData)</span><br><span class="line">            this.handleTreeData()</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &#x27;修改失败,请重试&#x27;,</span><br><span class="line">              type: &#x27;error&#x27;,</span><br><span class="line">            &#125;)</span><br><span class="line">            this.handleNodeClick(this.selectTreeData)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      //   新增从站对象</span><br><span class="line">      //   这里具体的接口还没有测试成功 只是写了个demo 这里确实是需要两个id</span><br><span class="line">      //   接口本身就需要这两个id 然后 也需要删除掉多余的那些adding和editing</span><br><span class="line">      //   测试新增不成功的原因就是因为 下拉框 这个从站的新增 涉及到很多 很多的下拉框</span><br><span class="line">      //   且就算当前项目不需要 以后的项目 也会需要这个东西 </span><br><span class="line">      else if (this.salveStatus &amp;&amp; row.adding) &#123;</span><br><span class="line">        console.log(&#x27;新增从站对象&#x27;)</span><br><span class="line">        this.$set(this.tableData[index], &#x27;model_id&#x27;, this.model_id)</span><br><span class="line">        this.$set(this.tableData[index], &#x27;bus_object_id&#x27;, this.bus_id)</span><br><span class="line">        this.$delete(this.tableData[index], &#x27;editing&#x27;)</span><br><span class="line">        this.$delete(this.tableData[index], &#x27;adding&#x27;)</span><br><span class="line">        let obj = JSON.stringify(row)</span><br><span class="line">        row.editing = false</span><br><span class="line">        addSlaveObj(obj).then((res) =&gt; &#123;</span><br><span class="line">          if (res.code == 1) &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &#x27;新增成功&#x27;,</span><br><span class="line">              type: &#x27;success&#x27;,</span><br><span class="line">            &#125;)</span><br><span class="line">            this.handleNodeClick(this.selectTreeData)</span><br><span class="line">            this.handleTreeData()</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &#x27;新增失败,请重试&#x27;,</span><br><span class="line">              type: &#x27;error&#x27;,</span><br><span class="line">            &#125;)</span><br><span class="line">            this.handleNodeClick(this.selectTreeData)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      //   更新从站对象</span><br><span class="line">      else if (this.salveStatus &amp;&amp; !row.adding) &#123;</span><br><span class="line">        console.log(&#x27;更新从站对象&#x27;)</span><br><span class="line">        updateSlaveObj(row).then((res) =&gt; &#123;</span><br><span class="line">          if (res.code == 1) &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &#x27;更新成功&#x27;,</span><br><span class="line">              type: &#x27;success&#x27;,</span><br><span class="line">            &#125;)</span><br><span class="line">            row.editing = false</span><br><span class="line">            this.$delete(this.tableData[index], &#x27;editing&#x27;)</span><br><span class="line">            this.$delete(this.tableData[index], &#x27;adding&#x27;)</span><br><span class="line">            this.handleNodeClick(this.selectTreeData)</span><br><span class="line">            this.handleTreeData()</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &#x27;新增失败,请重试&#x27;,</span><br><span class="line">              type: &#x27;error&#x27;,</span><br><span class="line">            &#125;)</span><br><span class="line">            this.handleNodeClick(this.selectTreeData)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; </span><br><span class="line">        // 新增点数据</span><br><span class="line">      else if (this.pointStatus &amp;&amp; row.adding) &#123;</span><br><span class="line">        console.log(&#x27;新增数据点数据&#x27;)</span><br><span class="line">        this.$set(this.tableData[index], &#x27;model_id&#x27;, this.model_id)</span><br><span class="line">        this.$set(this.tableData[index], &#x27;bus_object_id&#x27;, this.bus_id)</span><br><span class="line">        this.$set(this.tableData[index], &#x27;slave_object_id&#x27;, this.slave_Id)</span><br><span class="line">        this.$delete(this.tableData[index], &#x27;editing&#x27;)</span><br><span class="line">        this.$delete(this.tableData[index], &#x27;adding&#x27;)</span><br><span class="line">        console.log(row)</span><br><span class="line">        let obj = JSON.stringify(row)</span><br><span class="line">        addTagObj(obj).then((res) =&gt; &#123;</span><br><span class="line">          if (res.code == 1) &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &#x27;新增成功&#x27;,</span><br><span class="line">              type: &#x27;success&#x27;,</span><br><span class="line">            &#125;)</span><br><span class="line">            row.editing = false</span><br><span class="line">            this.handleNodeClick(this.selectTreeData)</span><br><span class="line">            this.handleTreeData()</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: res.msg,</span><br><span class="line">              type: &#x27;error&#x27;,</span><br><span class="line">            &#125;)</span><br><span class="line">            this.handleNodeClick(this.selectTreeData)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      // 更新点数据</span><br><span class="line">      else &#123;</span><br><span class="line">         console.log(&#x27;修改数据点数据&#x27;)</span><br><span class="line">        this.$set(this.tableData[index], &#x27;model_id&#x27;, this.model_id)</span><br><span class="line">        this.$set(this.tableData[index], &#x27;bus_object_id&#x27;, this.bus_id)</span><br><span class="line">        this.$set(this.tableData[index], &#x27;slave_object_id&#x27;, this.slave_Id)</span><br><span class="line">        this.$delete(this.tableData[index], &#x27;editing&#x27;)</span><br><span class="line">        let obj = JSON.stringify(row)</span><br><span class="line">        updateTagObj(obj).then((res) =&gt; &#123;</span><br><span class="line">          if (res.code == 1) &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &#x27;更新成功&#x27;,</span><br><span class="line">              type: &#x27;success&#x27;,</span><br><span class="line">            &#125;)</span><br><span class="line">            row.editing = false</span><br><span class="line">            this.handleNodeClick(this.selectTreeData)</span><br><span class="line">            this.handleTreeData()</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: res.msg,</span><br><span class="line">              type: &#x27;error&#x27;,</span><br><span class="line">            &#125;)</span><br><span class="line">            this.handleNodeClick(this.selectTreeData)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 删除当前行 调用接口删除当前行</span><br><span class="line">    // 这里如果不调用函数就可以直接使用 this.tableData.splice(index, 1) 来删除 做一个假删除就好了</span><br><span class="line">    // 但是如果存在其他的接口调用的话 dom从新渲染一下 还是会导致数据的刷新 那么就露馅了</span><br><span class="line">    //  所以自己测试可以使用这个方法 但是前后端联调 还是要走接口 然后 再次获取一下删除后的所有数据 就实现了这个功能</span><br><span class="line">    //  确保了数据的及时性 </span><br><span class="line">    handleDelete(index, row) &#123;</span><br><span class="line">      //   处理特殊情况 如果存在新增空对象直接删除的情况</span><br><span class="line">      if (!row.id) &#123;</span><br><span class="line">        this.tableData.splice(index, 1)</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">          //   这里是模型管理 删除模型</span><br><span class="line">          //   这里也是巧妙的运用了状态改变来 保证删除数据的准确性</span><br><span class="line">          //   如果是删除model的话，就要走modal删除的接口 然后再调用对应的接口 进行回调</span><br><span class="line">        if (this.modalStatus) &#123;</span><br><span class="line">          let obj = &#123;</span><br><span class="line">            id: row.id,</span><br><span class="line">          &#125;</span><br><span class="line">          obj = JSON.stringify(obj)</span><br><span class="line">          deleteBusModel(obj).then((res) =&gt; &#123;</span><br><span class="line">            if (res.code == 1) &#123;</span><br><span class="line">              this.$emit(&#x27;modalManager&#x27;)</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                message: &#x27;删除成功&#x27;,</span><br><span class="line">                type: &#x27;success&#x27;,</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                message: res.msg,</span><br><span class="line">                type: &#x27;error&#x27;,</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        //   删除数据点数据</span><br><span class="line">        else if (this.pointStatus) &#123;</span><br><span class="line">          let obj = &#123;</span><br><span class="line">            id: row.id,</span><br><span class="line">          &#125;</span><br><span class="line">          obj = JSON.stringify(obj)</span><br><span class="line">          deleteTagObj(obj).then((res) =&gt; &#123;</span><br><span class="line">            if (res.code == 1) &#123;</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                message: &#x27;删除成功&#x27;,</span><br><span class="line">                type: &#x27;success&#x27;,</span><br><span class="line">              &#125;)</span><br><span class="line">              this.handleNodeClick(this.selectTreeData)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                message: res.msg,</span><br><span class="line">                type: &#x27;error&#x27;,</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        //   删除总线的数据</span><br><span class="line">        else if (this.busStatus) &#123;</span><br><span class="line">          console.log(&#x27;删除总线的数据&#x27;)</span><br><span class="line"></span><br><span class="line">          let obj = &#123;</span><br><span class="line">            id: row.id,</span><br><span class="line">          &#125;</span><br><span class="line">          obj = JSON.stringify(obj)</span><br><span class="line">          deleteBusObj(obj).then((res) =&gt; &#123;</span><br><span class="line">            if (res.code == 1) &#123;</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                message: &#x27;删除成功&#x27;,</span><br><span class="line">                type: &#x27;success&#x27;,</span><br><span class="line">              &#125;)</span><br><span class="line">              this.handleTreeData()</span><br><span class="line">              this.handleNodeClick(this.selectTreeData)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                message: res.msg,</span><br><span class="line">                type: &#x27;error&#x27;,</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        //   删除从站数据</span><br><span class="line">        else if (this.salveStatus) &#123;</span><br><span class="line">          console.log(&#x27;删除从站的数据&#x27;)</span><br><span class="line"></span><br><span class="line">          let obj = &#123;</span><br><span class="line">            id: row.id,</span><br><span class="line">          &#125;</span><br><span class="line">          obj = JSON.stringify(obj)</span><br><span class="line">          deleteSlaveObj(obj).then((res) =&gt; &#123;</span><br><span class="line">            if (res.code == 1) &#123;</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                message: &#x27;删除成功&#x27;,</span><br><span class="line">                type: &#x27;success&#x27;,</span><br><span class="line">              &#125;)</span><br><span class="line">              this.handleNodeClick(this.selectTreeData)</span><br><span class="line">              this.handleTreeData()</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                message: res.msg,</span><br><span class="line">                type: &#x27;error&#x27;,</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          console.log(&#x27;其他情况&#x27;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 取消table行内操作</span><br><span class="line">    // 取消行内table的操作，其实这里还差了一步操作，</span><br><span class="line">    // 正常来说应该是去掉editing的状态 然后再给页面重新获取一遍所有值</span><br><span class="line">    // 因为你没法确定他是操作的哪个表单 那个页面 哪个东西 所以只能重新获取 这样既达到了清空输入的值</span><br><span class="line">    // 也达到了数据实时性的目的 因为row存在一个 新增还是编辑 如果是编辑就无法清空数据啊 所以只能是获取一边接口</span><br><span class="line">    // 上文中不是 Vuex保存了treeData么，这里调用一下handleclcik方法 就可以保证页面还是在选中的页面，但是数据是最新的数据</span><br><span class="line">    // 这里是巧妙的运用函数和组件的双向绑定的原理 保证触发函数 导致组件变化的 这才是双向绑定的原理</span><br><span class="line">    // 你组件可以触发 那么函数一样可以触发组件啊</span><br><span class="line">    handleCancel(index, row) &#123;</span><br><span class="line">      row.editing = false</span><br><span class="line">      this.handleNodeClick(this.selectTreeData)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 确定上传模型</span><br><span class="line">    // 这里是作为父组件 触发了子组件的方法，用的$refs来触发对应组件的方法 让上传方法触发</span><br><span class="line">    // 这里这样做是因为 本来就是做的异步上传，且上传的按钮一定是放在父级中的 不可以包裹在子组件中</span><br><span class="line">    // 这样易用度会高一点 </span><br><span class="line">    uploadSubmit() &#123;</span><br><span class="line">      this.$refs.uploadSo.submitUpload()</span><br><span class="line">    &#125;,</span><br><span class="line">    // 取消模型新增</span><br><span class="line">    // 这里涉及到两个方法 一个方法是将对话框进行关闭</span><br><span class="line">    // 第二个方法就是取消上传，这里取消上传的里面会将选中的list进行清空</span><br><span class="line">    // 如果不清空，下次用户触发组件 会发现list里面已经包含文件了</span><br><span class="line">    uploadCancel() &#123;</span><br><span class="line">      this.dialogSoVisible = false</span><br><span class="line">      this.$refs.uploadSo.cancelSubmit()</span><br><span class="line">    &#125;,</span><br><span class="line">    // 成功后关闭对话框</span><br><span class="line">    isShowUploadSo() &#123;</span><br><span class="line">      this.dialogSoVisible = false</span><br><span class="line">    &#125;,</span><br><span class="line">    // 模型下载 这里是后台直接拼串了 所以在这里只需要请求</span><br><span class="line">    // 这里其实 不写外部函数也可以，但是由于测试中发现 request中axios拼串虽然可以实现这个功能</span><br><span class="line">    // 但是由于不知道是浏览器还是goahead的原因，会存在缓存再次打开的问题，所以这里还是要实现，返回给我一个url</span><br><span class="line">    // 然后let openUrl = res.data.url</span><br><span class="line">    // window.open(openUrl)  或者 window.herf(openUrl) 或者link.herf() 都是可以的</span><br><span class="line">    // 这里不推荐使用二进制流进行下载 因为很麻烦 且 性能问题有待考究</span><br><span class="line">    handleDownload(index, row) &#123;</span><br><span class="line">      downloadBus(row.id)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 这是第二个弹出框，这里封装了对CSV的导入 也就是上传</span><br><span class="line">    // 虽然都是上传组件 但是两个组件的性质不同 且调用的方法不同</span><br><span class="line">    // 虽然可以使用Vuex或者传递status来区分走哪个接口 但是毕竟两个文件的很多限制以及其他都不同</span><br><span class="line">    // 所以对于从站数据点的控制这里 我们不能新增只能让他进行覆盖，先导出一个csv模板，然后一模一样的填写完毕再上传进来就好了</span><br><span class="line">    // 做覆盖 远比做CRUD要好得多 下面的就是基本操作了 没有什么特殊的了</span><br><span class="line">    // 导入Csv</span><br><span class="line">    handleImport() &#123;</span><br><span class="line">      this.dialogExcelVisible = true</span><br><span class="line">    &#125;,</span><br><span class="line">    // 导入Csv后关闭对话框</span><br><span class="line">    isShowUploadCsv() &#123;</span><br><span class="line">      this.dialogExcelVisible = false</span><br><span class="line">    &#125;,</span><br><span class="line">    // 确认导入Csv</span><br><span class="line">    submitUploadCsv() &#123;</span><br><span class="line">      this.$refs.uploadCsv.submitCsvUpload()</span><br><span class="line">    &#125;,</span><br><span class="line">    // 取消导入Csv</span><br><span class="line">    cancelUploadCsv() &#123;</span><br><span class="line">      this.dialogExcelVisible = false</span><br><span class="line">      this.$refs.uploadCsv.cancelSubmit()</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 导出CSV模板</span><br><span class="line">    // 确定了头数组和要过滤的数组</span><br><span class="line">    // 然后使用一个for循环将所有要取出来的header遍历出来 记住这里不能遍历中文header因为使用的是CSV</span><br><span class="line">    // 所以遍历出来的是key值，也就是对应数据库中的属性值。</span><br><span class="line">    // 你将tHeader写成label就是excel 写成value就是CSV就这么简单</span><br><span class="line">    handleExport() &#123;</span><br><span class="line">      this.downloadLoading = true</span><br><span class="line">      import(&#x27;@/vendor/Export2Excel&#x27;).then((excel) =&gt; &#123;</span><br><span class="line">        let tHeader = []</span><br><span class="line">        let filterVal = []</span><br><span class="line">        for (let item in this.columns) &#123;</span><br><span class="line">          tHeader.push(this.columns[item].value)</span><br><span class="line">          filterVal.push(this.columns[item].value)</span><br><span class="line">        &#125;</span><br><span class="line">        const list = this.tableData</span><br><span class="line">        const data = this.formatJson(filterVal, list)</span><br><span class="line">        excel.export_json_to_excel(&#123;</span><br><span class="line">          header: tHeader,</span><br><span class="line">          data,</span><br><span class="line">          filename: &#x27;配置信息&#x27;,</span><br><span class="line">          bookType: &#x27;xlsx&#x27;,</span><br><span class="line">        &#125;)</span><br><span class="line">        this.downloadLoading = false</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    formatJson(filterVal, jsonData) &#123;</span><br><span class="line">      return jsonData.map((v) =&gt;</span><br><span class="line">        filterVal.map((j) =&gt; &#123;</span><br><span class="line">          if (j === &#x27;timestamp&#x27;) &#123;</span><br><span class="line">            return parseTime(v[j])</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            return v[j]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      )</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="1-3-动态Url读取接口"><a href="#1-3-动态Url读取接口" class="headerlink" title="1.3 动态Url读取接口"></a>1.3 动态Url读取接口</h2><p>因为项目需要部署到本地机上面，所以不会存在跨域的问题，然后又因为这个后端并不是固定的发布到某个服务器上面的的，所以会动态改变，需要我们前端</p>
<p>通过浏览器的地址栏来获取到请求头，请求头就是url最前面的那个地址以及端口号，然后自己拼接”action”，再加上本身功能的api名称即可。</p>
<p>这里我想到了两种解决办法：</p>
<ol>
<li>因为本地使用的是配置文件和process.Env的搭配方式来改变接口的地址，所以我们不可以动态修改配置文件，只能选择用</li>
</ol>
<p>覆盖的方法，在api.js中，每次打包发版就用baseUrl覆盖一下即可。这个，BaseUrl就用外部函数处理store得到即可，下面是代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// VueX代码</span></span><br><span class="line"><span class="comment">// @/store/modules/url.js</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">    <span class="attr">localUrl</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">    <span class="attr">SET_Url</span>: <span class="function">(<span class="params">state, data</span>) =&gt;</span> &#123;</span><br><span class="line">        state.localUrl = data</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">    <span class="function"><span class="title">setApiUrl</span>(<span class="params">&#123; commit &#125;, data</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            commit(<span class="string">&#x27;SET_Url&#x27;</span>, data)</span><br><span class="line">            resolve()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">namespaced</span>: <span class="literal">true</span>,</span><br><span class="line">    state,</span><br><span class="line">    mutations,</span><br><span class="line">    actions</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取值的方法</span></span><br><span class="line"><span class="comment">// APP.vue </span></span><br><span class="line"><span class="comment">// mounted生命周期直接拿 然后去除多余的 拼串 调用store方法 存入Vuex状态树即可</span></span><br><span class="line"><span class="comment">// 这样当你登录的时候 就已经存放了最开始的地址和端口的值了</span></span><br><span class="line"> <span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = <span class="built_in">window</span>.location.href</span><br><span class="line">      .replace(<span class="string">&#x27;index.html&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">      .split(<span class="string">&#x27;#&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">      .toString()</span><br><span class="line">    <span class="built_in">this</span>.$store.dispatch(<span class="string">&#x27;url/setApiUrl&#x27;</span>, data)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">window</span>.location.href.replace(<span class="string">&#x27;index.html&#x27;</span>, <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">    <span class="built_in">console</span>.log(</span><br><span class="line">      <span class="built_in">window</span>.location.href.replace(<span class="string">&#x27;index.html&#x27;</span>, <span class="string">&#x27;&#x27;</span>).split(<span class="string">&#x27;#&#x27;</span>)[<span class="number">0</span>].toString()</span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>



<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @/utils/setUrl.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;../store/index.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> localUrl = store.state.url.localUrl + <span class="string">&quot;action/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> localUrl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// @/api/xxx-pro.js</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="keyword">import</span> localUrl <span class="keyword">from</span> <span class="string">&#x27;@/utils/setUrl&#x27;</span></span><br><span class="line"><span class="comment">// 获取所有模型</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getBusModel</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/cbus_getBusModelInfo4Web&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        <span class="attr">baseURL</span>: localUrl,</span><br><span class="line">        <span class="attr">params</span>: param,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @/api/xxx.js</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="comment">// 获取所有模型</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getBusModel</span>(<span class="params">param</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> request(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;/cbus_getBusModelInfo4Web&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        <span class="attr">params</span>: param,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发版的时候 </span></span><br><span class="line">@/views/XXX/XXX.vue</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  getBusModel,</span><br><span class="line">  getTreeInfo,</span><br><span class="line">  getBusById,</span><br><span class="line">  getSlaveByBusId,</span><br><span class="line">  getTagObjById,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/communication-pro&#x27;</span></span><br><span class="line"><span class="comment">// 开发环境开发的时候 </span></span><br><span class="line">@/views/xxx/xxx.vue</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  getBusModel,</span><br><span class="line">  getTreeInfo,</span><br><span class="line">  getBusById,</span><br><span class="line">  getSlaveByBusId,</span><br><span class="line">  getTagObjById,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@/api/communication&#x27;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>还有就是用请求头来改变，我其实第一次想到的就是这个办法，但是当时我没有意识到，在request.js的外部函数里面是无法读到store的值的，想要读到</li>
</ol>
<p>store里面的值必须要放到request请求体函数里面，或者response里面才可以正常读到。这样就是可以在请求的时候，用config来改变baseUrl，就省去了在创</p>
<p>建axios的时候判断baseUrl和在api.js中覆盖的方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; MessageBox, Message &#125; <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;../../src/store/index.js&quot;</span></span><br><span class="line"><span class="comment">// create an axios instance</span></span><br><span class="line"><span class="keyword">let</span> service = axios.create(&#123;</span><br><span class="line">    <span class="attr">baseURL</span>: process.env.VUE_APP_BASE_API,</span><br><span class="line">    <span class="attr">timeout</span>: <span class="number">10000</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@name</span>:request interceptor </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@msg</span>: 请求拦截器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;*&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">service.interceptors.request.use(</span><br><span class="line">    <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">/** 这里做了请求修改</span></span><br><span class="line"><span class="comment">        * 首先要明确一点 不能store在外面引用 必须要在 service服务函数里面调用store 才有值</span></span><br><span class="line"><span class="comment">        * 一般对于动态的请求路径 都是放到请求头里改变的  config.baseURL</span></span><br><span class="line"><span class="comment">        * 然后这个运行环境 (process.env.NODE_ENV) 可以通过运行环境来判断 以这个作为判断条件 就可以做到不读配置文件 </span></span><br><span class="line"><span class="comment">        * 读取Vuex的Url来作为请求头 （store.state.url.localUrl）</span></span><br><span class="line"><span class="comment">        * 如果你的环境就是开发环境 那么就是正常读 配置文件里的地址</span></span><br><span class="line"><span class="comment">        * 如果你的环境是打包后的话 就是读store里的 这样就规避掉了每个Vue都要修改BaseUrl的问题</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">if</span> (process.env.NODE_ENV == <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">            config.baseURL = store.state.url.localUrl + <span class="string">&quot;action/&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> config</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@name</span>:  response interceptor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@msg</span>: 响应拦截器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;*&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">service.interceptors.response.use(</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 这里如果我们想要得到http的返回信息，例如：报头或者状态</span></span><br><span class="line"><span class="comment">     * 请返回 response =&gt; response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = response.data</span><br><span class="line">        <span class="keyword">if</span> (res.code !== <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(res)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(res)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * error读取status需要 error.response.status</span></span><br><span class="line"><span class="comment">     * 不然正常的方法是读取不到status的 只能读到错误信息</span></span><br><span class="line"><span class="comment">     * 这里对于https的状态码判断就要放到error里面才好使</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (error.response.status == <span class="number">404</span>) &#123;</span><br><span class="line">            Message(&#123;</span><br><span class="line">                <span class="attr">message</span>: <span class="string">&#x27;服务器找不到&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">                <span class="attr">duration</span>: <span class="number">1000</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error.response.status == <span class="number">400</span>) &#123;</span><br><span class="line">            Message(&#123;</span><br><span class="line">                <span class="attr">message</span>: <span class="string">&#x27;服务器不理解请求的语法&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">                <span class="attr">duration</span>: <span class="number">1000</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error.response.status == <span class="number">500</span>) &#123;</span><br><span class="line">            Message(&#123;</span><br><span class="line">                <span class="attr">message</span>: <span class="string">&#x27;服务器遇到错误，无法完成请求&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">                <span class="attr">duration</span>: <span class="number">1000</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Message(&#123;</span><br><span class="line">                <span class="attr">message</span>: <span class="string">&#x27;服务器遇到未知错误，请稍后重试&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">                <span class="attr">duration</span>: <span class="number">1000</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="1-4-上传文件"><a href="#1-4-上传文件" class="headerlink" title="1.4 上传文件"></a>1.4 上传文件</h2><p>上传文件主要分为两部分，上传csv文件和上传so文件，这里是用了同样的逻辑，但是改动了一点小小细节，主要是对文件的判断，以及formdata的传参方式</p>
<p>将文件上传成功的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-upload</span><br><span class="line">    ref=&quot;upload&quot;</span><br><span class="line">    class=&quot;upload-demo&quot;</span><br><span class="line">    action</span><br><span class="line">    :http-request=&quot;httpRequest&quot;</span><br><span class="line">    :on-preview=&quot;handlePreview&quot;</span><br><span class="line">    :on-remove=&quot;handleRemove&quot;</span><br><span class="line">    :before-remove=&quot;beforeRemove&quot;</span><br><span class="line">    :limit=&quot;1&quot;</span><br><span class="line">    :auto-upload=&quot;false&quot;</span><br><span class="line">    :before-upload=&quot;beforeUpload&quot;</span><br><span class="line">    :on-exceed=&quot;handleExceed&quot;</span><br><span class="line">    :on-success=&quot;handleSuccess&quot;</span><br><span class="line">    :on-change=&quot;handleChange&quot;</span><br><span class="line">    :file-list=&quot;fileList&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;el-button slot=&quot;trigger&quot; size=&quot;small&quot; type=&quot;primary&quot;&gt;选择文件&lt;/el-button&gt;</span><br><span class="line">    &lt;div slot=&quot;tip&quot; class=&quot;el-upload__tip&quot;&gt;只能上传配置文件，且不超过500kb&lt;/div&gt;</span><br><span class="line">  &lt;/el-upload&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; uploadInfo &#125; from &#x27;@/api/communication&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      fileList: [],</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">   // 如果是点操作，就应该是注入handleCilck(treeData)</span><br><span class="line">  inject: [&#x27;modalManager&#x27;],</span><br><span class="line">  methods: &#123;</span><br><span class="line">    //文件列表移除文件时的钩子</span><br><span class="line">    handleRemove(file, fileList) &#123;</span><br><span class="line">      console.log(&#x27;这里是移除文件后的列表&#x27;)</span><br><span class="line">      console.log(file, fileList)</span><br><span class="line">    &#125;,</span><br><span class="line">    // 点击文件列表中已上传的文件时的钩子</span><br><span class="line">    handlePreview(file) &#123;</span><br><span class="line">      console.log(&#x27;进行预览操作，一般情况下图片才会用到&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line">    // 文件上传前的钩子</span><br><span class="line">    // 正则判断是否是so结尾的文件 </span><br><span class="line">    beforeUpload(file) &#123;</span><br><span class="line">      var FileExt = file.name.replace(/.+\./, &#x27;&#x27;)</span><br><span class="line">      if ([&#x27;so&#x27;].indexOf(FileExt) === -1) &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          type: &#x27;warning&#x27;,</span><br><span class="line">          message: &#x27;请上传后缀名为 so 的驱动文件！&#x27;,</span><br><span class="line">        &#125;)</span><br><span class="line">        return false</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 选择文件的钩子</span><br><span class="line">    handleExceed(files, fileList) &#123;</span><br><span class="line">      this.$message.warning(</span><br><span class="line">        `当前限制选择 1个文件，本次选择了 $&#123;files.length&#125; 个文件，共选择了 $&#123;</span><br><span class="line">          files.length + fileList.length</span><br><span class="line">        &#125; 个文件`</span><br><span class="line">      )</span><br><span class="line">    &#125;,</span><br><span class="line">    // 移除文件前的钩子</span><br><span class="line">    beforeRemove(file, fileList) &#123;</span><br><span class="line">      return this.$confirm(`确定移除 $&#123;file.name&#125;？`)</span><br><span class="line">    &#125;,</span><br><span class="line">    // 上传成功钩子(在这里可以处理上传成功后端返回的数据)</span><br><span class="line">    handleSuccess(rep, file, fileList) &#123;</span><br><span class="line">      console.log(&#x27;上传成功&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line">    // 上传方法</span><br><span class="line">    // 自定义的上传方法 都是这个接口利用.then的回调 然后formdata的传参方式传递的</span><br><span class="line">    httpRequest(param) &#123;</span><br><span class="line">      let formData = new FormData()</span><br><span class="line">      formData.append(&#x27;file&#x27;, param.file)</span><br><span class="line">      uploadInfo(formData).then((res) =&gt; &#123;</span><br><span class="line">        if (res.code == 1) &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            message: &#x27;上传成功&#x27;,</span><br><span class="line">            type: &#x27;success&#x27;,</span><br><span class="line">          &#125;)</span><br><span class="line">          // 调用父级方法 关闭弹出框</span><br><span class="line">          this.$emit(&#x27;isShowUploadSo&#x27;)</span><br><span class="line">          // 清空文件列表</span><br><span class="line">          this.fileList = []</span><br><span class="line">          // 调用父级获取全部模型的接口</span><br><span class="line">          this.modalManager()</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            message: &#x27;上传失败。请稍后再试&#x27;,</span><br><span class="line">            type: &#x27;error&#x27;,</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    // 确认提交</span><br><span class="line">    // 这个方法会在父级代码里调用 属于是父组件调用子组件的方法来提交</span><br><span class="line">    submitUpload() &#123;</span><br><span class="line">      console.log(&#x27;进入方法&#x27;)</span><br><span class="line">      if (this.fileList.length == 0) &#123;</span><br><span class="line">        this.$message.error(&#x27;请选择文件后进行上传&#x27;)</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this.$refs.upload.submit()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 取消提交</span><br><span class="line">    cancelSubmit() &#123;</span><br><span class="line">      this.fileList = []</span><br><span class="line">      console.log(&#x27;子组件被调用&#x27;)</span><br><span class="line">    &#125;,</span><br><span class="line">    // 组件发生改变时的钩子</span><br><span class="line">    handleChange(file, fileList) &#123;</span><br><span class="line">      console.log(&#x27;改变的文件是&#x27;)</span><br><span class="line">      console.log(file)</span><br><span class="line">      console.log(&#x27;改变后的列表&#x27;)</span><br><span class="line">      console.log(fileList)</span><br><span class="line">      this.fileList = fileList</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>Post title：本地控制器</li>
        <li>Post author：iam_Echo</li>
        <li>Create time：2022-02-14 09:48:30</li>
        <li>
            Post link：https://hurryliwei.github.io/2022/02/14/本地控制器/
        </li>
        <li>
            Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

            </div>
        

        
            <div class="article-nav">
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2021/12/10/Vue-element-admin%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Vue-element-admin查漏补缺</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;Comments</i>
    </div>
    

        
            
    <div class="valine-container">
        <script 
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script >
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: 'QUxpNcJdPriNR5IPsdvNBVAS-gzGzoHsz',
                    appKey: 'iau4kX9v3NAQ22FqzYxy9lmA',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: '',
                    lang: 'en'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return '博主';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'iam_Echo';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('false') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">iam_Echo</a>
        </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.3</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E6%8E%A7%E5%88%B6%E5%99%A8%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3"><span class="nav-text">本地控制器前端开发文档</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E9%80%9A%E4%BF%A1%E5%8F%82%E6%95%B0%E9%87%87%E9%9B%86%E5%8A%9F%E8%83%BD"><span class="nav-text">1. 通信参数采集功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-%E5%8A%9F%E8%83%BD%E9%A1%B5%E9%9D%A2%E7%9A%84%E6%9E%84%E5%BB%BA"><span class="nav-text">1.1 功能页面的构建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-%E5%85%B7%E4%BD%93%E6%96%B9%E6%B3%95%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">1.2 具体方法的实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E5%8A%A8%E6%80%81Url%E8%AF%BB%E5%8F%96%E6%8E%A5%E5%8F%A3"><span class="nav-text">1.3 动态Url读取接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6"><span class="nav-text">1.4 上传文件</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>





    
<script src="/js/code-copy.js"></script>





<div class="post-scripts">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>



</body>
</html>
